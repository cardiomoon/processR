xmargin=0.01;radx=0.12
ymargin=0.02;xlim=c(-0.2,1.2);ylim=xlim
rady=0.04;maxypos=0.6;minypos=0;ypos=c(1,0.5);mpos=c(0.5,0.9)
xinterval=NULL;yinterval=NULL;xspace=NULL;label.pos=list()
digits=3
if("lm" %in%  class(fit)) fit=list(fit)
fitcount=length(fit)
fit[[1]]
df1=as.data.frame(summary(fit[[1]])$coef[-1,])
df1$label=rownames(df1)
if(!is.null(labels)) df1$label=changeLabelName(rownames(df1),labels,add=FALSE)
df1
names(df1)[4]="p"
df1$lty=ifelse(df1$p<0.05,1,2)
df1$name=paste0("a",1:nrow(df1))
df1$start=df1$label
df1$end=ifelse(fitcount==1,"Y","M")
df1$est=round(df1$Estimate,digits)
count=length(df1$label)
if(fitcount>1){
df2=as.data.frame(summary(fit[[2]])$coef[-1,])
df2$label=rownames(df2)
if(!is.null(labels)) df2$label=changeLabelName(rownames(df2),labels,add=FALSE)
names(df2)[4]="p"
df2$lty=ifelse(df2$p<0.05,1,2)
df2$name=""
ccount=length(df2$label[df2$label!="M"])
df2$name[df2$label=="M"]="b"
df2$name[df2$label!="M"]=paste0("c",1:ccount)
df2$start=df2$label
df2$end="Y"
df2$est=round(df2$Estimate,digits)
df2
}
name=c("Y","M",df1$label)
nodes=data.frame(name=name,stringsAsFactors = FALSE)
nodes
nodes$xpos=c(ypos[1],mpos[1],rep(0,count%/%2),0.05,(1:(1+count%/%2-1))/10)
nodes$ypos=c(ypos[2],mpos[2],((2+count%/%2):3),2,rep(1,count%/%2))
c(ypos[1],mpos[1],rep(0,count%/%2),0.05,(1:(1+count%/%2-1))/10)
#' labels=list(X="protest",W="sexism",M="respappr",Y="liking")
#' fit=makeCatModel(labels=labels,data=protest)
#' drawCatModel(fit,labels=labels,nodelabels=nodelabels,radx=0.08,xinterval=0.18,label.pos=list(a5=0.3))
#' drawCatModel(fit,labels=labels,whatLabel="name",maxypos=0.6,minypos=0.2)
#' labels=list(X="protest",M="respappr",Y="liking")
#' eq=catMediation(labels=labels,data=protest,mode=1,maxylev=6)
#' data1=addCatVars(protest,"protest")
#' fit=eq2fit(eq,data=data1)
#' modelsSummary(fit,labels=labels)
#' drawCatModel(fit,labels=labels)
drawCatModel=function(fit,labels=NULL,nodelabels=NULL,whatLabel="est",
xmargin=0.01,radx=0.12,
ymargin=0.02,xlim=c(-0.2,1.2),ylim=xlim,
rady=0.04,maxypos=0.6,minypos=0,ypos=c(1,0.5),mpos=c(0.5,0.9),
xinterval=NULL,yinterval=NULL,xspace=NULL,label.pos=list(),
digits=3){
# nodelabels=NULL;whatLabel="est"
# xmargin=0.01;radx=0.12
# ymargin=0.02;xlim=c(-0.2,1.2);ylim=xlim
# rady=0.04;maxypos=0.6;minypos=0;ypos=c(1,0.5);mpos=c(0.5,0.9)
# xinterval=NULL;yinterval=NULL;xspace=NULL;label.pos=list()
# digits=3
if("lm" %in%  class(fit)) fit=list(fit)
fitcount=length(fit)
fit[[1]]
df1=as.data.frame(summary(fit[[1]])$coef[-1,])
df1$label=rownames(df1)
if(!is.null(labels)) df1$label=changeLabelName(rownames(df1),labels,add=FALSE)
df1
names(df1)[4]="p"
df1$lty=ifelse(df1$p<0.05,1,2)
df1$name=paste0("a",1:nrow(df1))
df1$start=df1$label
df1$end=ifelse(fitcount==1,"Y","M")
df1$est=round(df1$Estimate,digits)
count=length(df1$label)
if(fitcount>1){
df2=as.data.frame(summary(fit[[2]])$coef[-1,])
df2$label=rownames(df2)
if(!is.null(labels)) df2$label=changeLabelName(rownames(df2),labels,add=FALSE)
names(df2)[4]="p"
df2$lty=ifelse(df2$p<0.05,1,2)
df2$name=""
ccount=length(df2$label[df2$label!="M"])
df2$name[df2$label=="M"]="b"
df2$name[df2$label!="M"]=paste0("c",1:ccount)
df2$start=df2$label
df2$end="Y"
df2$est=round(df2$Estimate,digits)
df2
}
name=c("Y","M",df1$label)
nodes=data.frame(name=name,stringsAsFactors = FALSE)
nodes
# c(ypos[1],mpos[1],rep(0,count%/%2),0.05,(1:(1+count%/%2-1))/10)
nodes$xpos=c(ypos[1],mpos[1],rep(0,count%/%2),0.05,(1:(1+count%/%2-1))/10)
nodes$ypos=c(ypos[2],mpos[2],((2+count%/%2):3),2,rep(1,count%/%2))
# nodes$xpos1=adjustxpos(nodes$xpos,xmargin=xmargin,radx=radx)
nodes$ypos=adjustypos(nodes$ypos,ymargin=ymargin,rady=rady,
maxypos=maxypos,minypos=minypos)
if(fitcount==1) {
nodes=nodes[-2,]
arrows=df1
} else{
arrows=rbind(df1,df2)
}
arrows$labelpos=0.5
arrows$arrpos=0.8
arrows$no=1
arrows$label1=arrows$label
if(whatLabel=="name") {
arrows$label=arrows$name
addprime=TRUE
} else{
arrows$label=arrows$est
addprime=FALSE
}
nodes
arrows
openplotmat(xlim=xlim,ylim=ylim)
for(i in 1:nrow(arrows)){
temppos=arrows$labelpos[i]
if(!is.null(label.pos[[arrows$name[i]]])) temppos=label.pos[[arrows$name[i]]]
myarrow2(nodes, from=arrows$start[i],to=arrows$end[i],
label=arrows$label[i],no=arrows$no[1],xmargin=xmargin,radx=radx,rady=rady,
label.pos=temppos,arr.pos=NULL,lty=arrows$lty[i],addprime=addprime,xspace=xspace)
}
for(i in 1:nrow(nodes)){
xpos=nodes$xpos[i]
xpos=adjustxpos(xpos,xmargin,radx,xspace=xspace)
mid=c(xpos,nodes$ypos[i])
label=nodes$name[i]
drawtext(mid,radx=radx,rady=rady,lab=label,latent=FALSE)
if(!is.null(nodelabels[[label]])) {
if(is.null(yinterval)) yinterval=2*rady+ymargin
if(is.null(xinterval)) xinterval=2*radx
if(mid[2]<=rady+ymargin){
newmid=mid-c(0,yinterval)
} else if(mid[2]>=0.9){
newmid=mid+c(0,yinterval)
} else if(mid[1]>0.85){
newmid=mid+c(xinterval,0)
} else{
newmid=mid-c(xinterval,0)
}
textplain(mid=newmid,lab=nodelabels[[label]])
}
}
}
labels=list(X="protest",W="sexism",M="respappr",Y="liking")
fit=makeCatModel(labels=labels,data=protest)
drawCatModel(fit,labels=labels,nodelabels=nodelabels,radx=0.08,xinterval=0.18,label.pos=list(a5=0.3))
library(processR)
#' @examples
labels=list(X="protest",W="sexism",M="respappr",Y="liking")
moderator=list(name="sexism",site=list(c("a","c")))
data1=addCatVars(protest,"protest",mode=3)
eq=catMediation(X="protest",M="respappr",Y="liking",moderator=moderator,data=protest,maxylev=6,mode=1)
fit=eq2fit(eq,data=data1)
modelsSummary2(fit,labels=labels)
nodelabels=list(D1="Ind.Protest",D2="Col.Protest",W="sexism",M="respappr",Y="liking")
drawCatModel(fit,labels=labels,nodelabels=nodelabels,whatLabel="name",xlim=c(-0.3,1.3))
drawCatModel(fit,labels=labels)
library(processR)
drawCatModel(fit,labels=labels,nodelabels=nodelabels,radx=0.08,xinterval=0.18,label.pos=list(a5=0.3))
library(processR)
drawCatModel(fit,labels=labels,nodelabels=nodelabels,radx=0.08,xinterval=0.18,label.pos=list(a5=0.3))
labels=list(X="protest",M="respappr",Y="liking")
eq=catMediation(labels=labels,data=protest,mode=1,maxylev=6)
data1=addCatVars(protest,"protest")
fit=eq2fit(eq,data=data1)
modelsSummary(fit,labels=labels)
drawCatModel(fit,labels=labels)
nodelabels=NULL;whatLabel="est"
xmargin=0.01;radx=0.12
ymargin=0.02;xlim=c(-0.2,1.2);ylim=xlim
rady=0.04;maxypos=0.6;minypos=0;ypos=c(1,0.5);mpos=c(0.5,0.9)
xinterval=NULL;yinterval=NULL;xspace=NULL;label.pos=list()
digits=3
if("lm" %in%  class(fit)) fit=list(fit)
fitcount=length(fit)
fit[[1]]
df1=as.data.frame(summary(fit[[1]])$coef[-1,])
df1$label=rownames(df1)
if(!is.null(labels)) df1$label=changeLabelName(rownames(df1),labels,add=FALSE)
df1
fit[[1]]
df1=as.data.frame(summary(fit[[1]])$coef[-1,])
df1$label=rownames(df1)
if(!is.null(labels)) df1$label=changeLabelName(rownames(df1),labels,add=FALSE)
df1
names(df1)[4]="p"
df1$lty=ifelse(df1$p<0.05,1,2)
df1$name=paste0("a",1:nrow(df1))
df1$start=df1$label
df1$end=ifelse(fitcount==1,"Y","M")
df1$est=round(df1$Estimate,digits)
count=length(df1$label)
df1
labels=list(X="protest",W="sexism",M="respappr",Y="liking")
moderator=list(name="sexism",site=list(c("a","c")))
data1=addCatVars(protest,"protest",mode=3)
eq=catMediation(X="protest",M="respappr",Y="liking",moderator=moderator,data=protest,maxylev=6,mode=1)
fit=eq2fit(eq,data=data1)
modelsSummary2(fit,labels=labels)
nodelabels=list(D1="Ind.Protest",D2="Col.Protest",W="sexism",M="respappr",Y="liking")
drawCatModel(fit,labels=labels,nodelabels=nodelabels,whatLabel="name",xlim=c(-0.3,1.3))
drawCatModel(fit,labels=labels)
nodes
labels=list(X="protest",W="sexism",M="respappr",Y="liking")
moderator=list(name="sexism",site=list(c("a","c")))
data1=addCatVars(protest,"protest",mode=3)
eq=catMediation(X="protest",M="respappr",Y="liking",moderator=moderator,data=protest,maxylev=6,mode=1)
fit=eq2fit(eq,data=data1)
modelsSummary2(fit,labels=labels)
nodelabels=list(D1="Ind.Protest",D2="Col.Protest",W="sexism",M="respappr",Y="liking")
if("lm" %in%  class(fit)) fit=list(fit)
fitcount=length(fit)
fit[[1]]
df1=as.data.frame(summary(fit[[1]])$coef[-1,])
df1$label=rownames(df1)
if(!is.null(labels)) df1$label=changeLabelName(rownames(df1),labels,add=FALSE)
df1
names(df1)[4]="p"
df1$lty=ifelse(df1$p<0.05,1,2)
df1$name=paste0("a",1:nrow(df1))
df1$start=df1$label
df1$end=ifelse(fitcount==1,"Y","M")
df1$est=round(df1$Estimate,digits)
count=length(df1$label)
if(fitcount>1){
df2=as.data.frame(summary(fit[[2]])$coef[-1,])
df2$label=rownames(df2)
if(!is.null(labels)) df2$label=changeLabelName(rownames(df2),labels,add=FALSE)
names(df2)[4]="p"
df2$lty=ifelse(df2$p<0.05,1,2)
df2$name=""
ccount=length(df2$label[df2$label!="M"])
df2$name[df2$label=="M"]="b"
df2$name[df2$label!="M"]=paste0("c",1:ccount)
df2$start=df2$label
df2$end="Y"
df2$est=round(df2$Estimate,digits)
df2
}
nodelabels=NULL;whatLabel="est"
xmargin=0.01;radx=0.12
ymargin=0.02;xlim=c(-0.2,1.2);ylim=xlim
rady=0.04;maxypos=0.6;minypos=0;ypos=c(1,0.5);mpos=c(0.5,0.9)
xinterval=NULL;yinterval=NULL;xspace=NULL;label.pos=list()
digits=3
if("lm" %in%  class(fit)) fit=list(fit)
fitcount=length(fit)
fit[[1]]
df1=as.data.frame(summary(fit[[1]])$coef[-1,])
df1$label=rownames(df1)
if(!is.null(labels)) df1$label=changeLabelName(rownames(df1),labels,add=FALSE)
df1
names(df1)[4]="p"
df1$lty=ifelse(df1$p<0.05,1,2)
df1$name=paste0("a",1:nrow(df1))
df1$start=df1$label
df1$end=ifelse(fitcount==1,"Y","M")
df1$est=round(df1$Estimate,digits)
count=length(df1$label)
if(fitcount>1){
df2=as.data.frame(summary(fit[[2]])$coef[-1,])
df2$label=rownames(df2)
if(!is.null(labels)) df2$label=changeLabelName(rownames(df2),labels,add=FALSE)
names(df2)[4]="p"
df2$lty=ifelse(df2$p<0.05,1,2)
df2$name=""
ccount=length(df2$label[df2$label!="M"])
df2$name[df2$label=="M"]="b"
df2$name[df2$label!="M"]=paste0("c",1:ccount)
df2$start=df2$label
df2$end="Y"
df2$est=round(df2$Estimate,digits)
df2
}
name=c("Y","M",df1$label)
nodes=data.frame(name=name,stringsAsFactors = FALSE)
nodes
# c(ypos[1],mpos[1],rep(0,count%/%2),0.05,(1:(1+count%/%2-1))/10)
str_detect(nodes$name)
require(stringr)
# c(ypos[1],mpos[1],rep(0,count%/%2),0.05,(1:(1+count%/%2-1))/10)
str_detect(nodes$name)
# c(ypos[1],mpos[1],rep(0,count%/%2),0.05,(1:(1+count%/%2-1))/10)
str_detect(nodes$name,":")
# c(ypos[1],mpos[1],rep(0,count%/%2),0.05,(1:(1+count%/%2-1))/10)
any(str_detect(nodes$name,":"))
labels=list(X="protest",M="respappr",Y="liking")
eq=catMediation(labels=labels,data=protest,mode=1,maxylev=6)
data1=addCatVars(protest,"protest")
fit=eq2fit(eq,data=data1)
modelsSummary(fit,labels=labels)
drawCatModel(fit,labels=labels)
library(processR)
modelsSummary(fit,labels=labels)
labels=list(X="protest",M="respappr",Y="liking")
eq=catMediation(labels=labels,data=protest,mode=1,maxylev=6)
data1=addCatVars(protest,"protest")
fit=eq2fit(eq,data=data1)
modelsSummary(fit,labels=labels)
drawCatModel(fit,labels=labels)
drawCatModel(fit,labels=labels,minypos=0.4z)
drawCatModel(fit,labels=labels,minypos=0.4)
drawCatModel(fit,labels=labels,minypos=0.3)
drawCatModel(fit,labels=labels,maxypos=0.6,minypos=0.3)
drawCatModel(fit,labels=labels,maxypos=0.5,minypos=0.3)
drawCatModel(fit,labels=labels,maxypos=0.55,minypos=0.3)
drawCatModel(fit,labels=labels)
drawCatModel(fit,labels=labels,miny=0.4)
drawCatModel(fit,labels=labels,miny=0.3)
drawCatModel(fit,labels=labels,maxy=0.5,miny=0.3)
drawCatModel(fit,labels=labels,maxy=0.5,miny=0.3)
drawCatModel(fit,labels=labels,maxy=0.6,miny=0.4)
drawCatModel(fit,labels=labels,maxy=0.6,miny=0.4,label.pos=list(a2=0.7))
drawCatModel(fit,labels=labels,maxy=0.6,miny=0.4,label.pos=list(a2=0.6))
drawCatModel(fit,labels=labels,maxy=0.6,miny=0.4)
library(processR)
nodelabels=list(D1="Ind.Protest",D2="Col.Protest",W="sexism",M="respappr",Y="liking")
labels=list(X="protest",M="respappr",Y="liking")
eq=catMediation(labels=labels,data=protest,mode=1,maxylev=6)
data1=addCatVars(protest,"protest")
fit=eq2fit(eq,data=data1)
modelsSummary(fit,labels=labels)
drawCatModel(fit,labels=labels,maxy=0.6,miny=0.4)
require(processR)
labels=list(X="protest",M="respappr",Y="liking")
eq=catMediation(labels=labels,data=protest,mode=1,maxylev=6)
data1=addCatVars(protest,"protest")
fit=eq2fit(eq,data=data1)
modelsSummary(fit,labels=labels)
drawCatModel(fit,labels=labels,maxy=0.6,miny=0.4)
nodelabels=list(D1="Ind.Protest",D2="Col.Protest",M="respappr",Y="liking")
eq=catMediation(labels=labels,data=protest,mode=1,maxylev=6)
data1=addCatVars(protest,"protest")
fit=eq2fit(eq,data=data1)
modelsSummary(fit,labels=labels)
drawCatModel(fit,labels=labels,maxy=0.6,miny=0.4,nodeslabels=nodeslabels)
drawCatModel(fit,labels=labels,maxy=0.6,miny=0.4,nodelabels=nodelabels)
drawCatModel(fit,labels=labels,maxy=0.6,miny=0.4,nodelabels=nodelabels)
library(processR)
drawCatModel(fit,labels=labels,maxy=0.6,miny=0.4,nodelabels=nodelabels)
drawCatModel(fit,labels=labels,maxy=0.6,miny=0.4,nodelabels=nodelabels,xlim=c(-0.3,1.2))
drawCatModel(fit,labels=labels,maxy=0.6,miny=0.4,nodelabels=nodelabels,xlim=c(-0.25,1.2))
devtools::document()
devtools::check()
data=protest
X="protest";M="resp";Y="liking"
digits=3; maxylev=6
data=addCatVars(data,X)
count=length(unique(data[[X]]))-1
data=protest
X="protest";M="resp";Y="liking"
require(processR)
data=addCatVars(data,X)
count=length(unique(data[[X]]))-1
data=protest
X="protest";M="resp";Y="liking"
data=addCatVars(data,X)
count=length(unique(data[[X]]))-1
newX=paste0(paste0("D",1:count),collapse="+")
newX
temp=paste0("lm(",Y,"~",M,"+",newX,",data=data)")
fit=eval(parse(text=temp))
newX
temp=paste0("lm(",Y,"~",M,"+",newX,",data=data)")
temp
X="protest";M="resappr";Y="liking"
temp=paste0("lm(",Y,"~",M,"+",newX,",data=data)")
temp
fit=eval(parse(text=temp))
X="protest";M="respappr";Y="liking"
newX=paste0(paste0("D",1:count),collapse="+")
newX
temp=paste0("lm(",Y,"~",M,"+",newX,",data=data)")
temp
fit=eval(parse(text=temp))
summary(fit)
data=protest
X="protest";M="respappr";Y="liking"
digits=3; maxylev=6;mode=1
data=addCatVars(data,X,mode=mode)
count=length(unique(data[[X]]))-1
newX=paste0(paste0("D",1:count),collapse="+")
newX
temp=paste0("lm(",Y,"~",M,"+",newX,",data=data)")
temp
fit=eval(parse(text=temp))
summary(fit)
ratio=getRatioTable(count=count+1,mode=mode)
ratio
summary(fit)
ratio
ratio[2,]
data=protest
X="protest";M="respappr";Y="liking"
digits=3; maxylev=6;mode=1
data=addCatVars(data,X,mode=mode)
count=length(unique(data[[X]]))-1
newX=paste0(paste0("D",1:count),collapse="+")
newX
temp=paste0("lm(",Y,"~",M,"+",newX,",data=data)")
temp
fit=eval(parse(text=temp))
summary(fit)
ratio=getRatioTable(count=count+1,mode=mode)
ratio
ratio[2,]
yhat=fit$coef[1]+fit$coef[2]*mean(data[[M]],na.rm=T)
for(i in 1:count){
yhat=yhat+fit$coef[2+i]*ratio[1+i,]
}
round(yhat,digits)
ratio
data=addCatVars(data,X,mode=mode)
count=length(unique(data[[X]]))-1
newX=paste0(paste0("D",1:count),collapse="+")
newX
temp=paste0("lm(",Y,"~",M,"+",newX,",data=data)")
temp
fit=eval(parse(text=temp))
summary(fit)
ratio=getRatioTable(count=count+1,mode=mode)
ratio
ratio[2,]
yhat=fit$coef[1]+fit$coef[2]*mean(data[[M]],na.rm=T)
for(i in 1:count){
yhat=yhat+fit$coef[2+i]*ratio[i+1,]
}
round(yhat,digits)
yhat=fit$coef[1]+fit$coef[2]*mean(data[[M]],na.rm=T)
for(i in 0:count){
yhat=yhat+fit$coef[3]*ratio[i+1,1]+fit$coef[4]*ratio[i+1,2]
}
round(yhat,digits)
yhat=fit$coef[1]+fit$coef[2]*mean(data[[M]],na.rm=T)
for(i in 0:count){
yhat=c(yhat,yhat+fit$coef[3]*ratio[i+1,1]+fit$coef[4]*ratio[i+1,2])
}
round(yhat,digits)
yhat=c()
yhat=fit$coef[1]+fit$coef[2]*mean(data[[M]],na.rm=T)
yhat
for(i in 0:count){
yhat=c(yhat,yhat+fit$coef[3]*ratio[i+1,1]+fit$coef[4]*ratio[i+1,2])
}
yhat
yhat=c()
temp=fit$coef[1]+fit$coef[2]*mean(data[[M]],na.rm=T)
for(i in 0:count){
yhat=c(yhat,temp+fit$coef[3]*ratio[i+1,1]+fit$coef[4]*ratio[i+1,2])
}
yhat
yhat=c()
temp=fit$coef[1]+fit$coef[2]*mean(data[[M]],na.rm=T)
for(i in 0:count){
temp1=0
for(j in 1:ncol(ratio)){
temp1=temp1+fit$coef[j+2]*ratio[i+1,j]
}
yhat=c(yhat,temp+temp1)
}
yhat
library(processR)
data=protest
labels=list(X="protest",M="respappr",Y="liking")
getYhat1(data=protest,labels=labels)
devtools::document()
library(processR)
data=protest
labels=list(X="protest",M="respappr",Y="liking")
getYhat1(data=protest,labels=labels)
library(processR)
data=protest
labels=list(X="protest",M="respappr",Y="liking")
getYhat1(data=protest,labels=labels)
labels=list(X="protest",Y="liking",M="respappr")
meanSummary(data=protest,labels=labels)
library(processR)
labels=list(X="protest",Y="liking",M="respappr")
meanSummary(data=protest,labels=labels)
meanSummary(data=protest,labels=labels,mode=3)
meanSummary(data=protest,labels=labels,mode=3)
meanSummary(data=protest,labels=labels)
devtools::document()
library(processR)
labels=list(X="protest",Y="liking",M="respappr")
meanSummary(data=protest,labels=labels)
meanSummary(data=protest,labels=labels,mode=3)
meanSummary(data=protest,labels=labels)
library(processR)
devtools::check()
devtools::document()
devtools::check()
labels=list(X="protest",Y="liking",M="respappr")
meanSummary(data=protest,labels=labels)
meanSummary(data=protest,labels=labels,maxylev=2)
library(processR)
devtools::docuemnt()
devtools::document()
devtools::check()
labels=list(X="cond",Y="reaction",M="pmi")
xlabels=c("Front Page","Interior Page")
meanSummary(data=pmi,labels=labels,xlabels=xlabels)
require(processR)
labels=list(X="cond",Y="reaction",M="pmi")
xlabels=c("Front Page","Interior Page")
meanSummary(data=pmi,labels=labels,xlabels=xlabels)
