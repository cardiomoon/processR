temp1=lapply(1:length(temp1),function(i){
unlist(strsplit(unlist(strsplit(temp1[i],"~",fixed=TRUE))[2],"+",fixed=TRUE))
})
temp1
# moderator
# MY
pos=mod2pos(moderator,name=MY,prefix="b")
pos
if(is.null(bmatrix)){
eq2=makeCatEquation2(X=M,Y=Y,W=MY,prefix="b",mode=mode,pos=pos)
} else{
eq2=makeCatEquation3(X=M,Y=Y,W=MY,prefix="b",mode=mode,pos=pos,bmatrix=bmatrix,depy=TRUE)
}
eq2
temp2=unlist(strsplit(eq2,"~"))[2]
temp2=unlist(strsplit(temp2,"+",fixed=TRUE))
temp2
}
pos=mod2pos(moderator,name=XM,prefix="a")
pos
if(is.null(bmatrix)){
eq1=makeCatEquation2(X=X,Y=M,W=XM,prefix="a",mode=mode,pos=pos,serial=serial)
} else{
eq1=makeCatEquation3(X=X,Y=M,W=XM,prefix="a",mode=mode,pos=pos,bmatrix=bmatrix,depy=FALSE)
}
# maxylev
eq1
#'@param depx logical
#'@export
#'@examples
#'cat(makeCatEquation3(X="X",Y=c("M1","M2","M3"),prefix="a",bmatrix=c(1,1,0,1,0,0,1,1,1,1)))
#'cat(makeCatEquation3(X="X",Y=c("M1","M2","M3"),prefix="a",bmatrix=c(1,1,0,1,0,1,1,1,1,1)))
#'cat(makeCatEquation3(X="X",Y=c("M1","M2","M3"),prefix="a",bmatrix=c(1,1,0,1,1,0,1,1,1,1)))
#'cat(makeCatEquation3(X="X",Y=c("M1","M2","M3"),prefix="a",bmatrix=c(1,1,1,1,1,1,1,1,1,1)))
#'cat(makeCatEquation3(X=c("M1","M2","M3"),Y="Y",prefix="a",bmatrix=c(1,1,1,1,1,1,1,1,1,1),depy=TRUE))
#'cat(makeCatEquation3(X="X",Y="Y",prefix="a",bmatrix=c(1,1,1,1,1,1,1,1,1,1),depy=TRUE,depx=TRUE))
#'cat(makeCatEquation3(X="X",Y="Y",prefix="a",bmatrix=c(1,1,1,1,1,1,0,1,1,1),depy=TRUE,depx=TRUE))
makeCatEquation3=function(X=NULL,Y=NULL,W=NULL,labels=list(),prefix="b",mode=0,pos=list(),bmatrix,depy=FALSE,depx=FALSE){
# X="X";Y=c("M1","M2","M3");W=NULL;labels=list();prefix="a";mode=0;pos=list();
# bmatrix=c(1,1,0,1,1,0,1,1,1,1);depy=FALSE
# bmatrix=c(1,1,1,1,1,1,1,1,1,1);depy=FALSE
# X=c("M1","M2","M3");Y="Y";W=NULL;labels=list();prefix="a";mode=0;pos=list();
# bmatrix=c(1,1,1,1,1,1,0,1,1,1);depy=TRUE
# X="X";Y="Y";W=NULL;prefix="a";bmatrix=c(1,1,1,1,1,1,0,1,1,1);depy=TRUE;depx=TRUE;mode=0;pos=list()
if(is.null(X)) X=labels$X
if(is.null(W)) if(!is.null(labels$W)) W=labels$W
if(is.null(Y)) Y=labels$Y
xgroup<-wgroup<-c()
xcount<-wcount<-ycount<-0
xcount=length(X)
wcount=length(W)
ycount=length(Y)
temp=c()
j=1
for(j in 1:ycount){
res1=c()
if(depy==FALSE){
for(i in 1:xcount){
res=c()
res=c(res,X[i])
for(l in seq_along(W)){
if(length(pos)==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(length(pos[[l]])==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(i %in% pos[[l]]){
res=c(res,W[l],paste0(X[i],":",W[l]))
}
}
if(mode==0){
temp1=c()
for(k in 1:length(res)){
temp1=c(temp1,paste0(prefix,ifelse(xcount>1,i,""),
ifelse(ycount>1,j,""),"*",res[k]))
}
} else{
temp1=res
}
res1=c(res1,temp1)
if(j>1){
for(k in 2:j){
pos=1+sum(1:(j-1))+(k-1)
# cat("j=",j,",k=",k,"\n")
# cat("pos=",pos,",bmatrix[pos]=",bmatrix[pos],"\n")
if(bmatrix[pos]==1){
if(mode==0) {
res1=c(res1,paste0("d",j,k-1,"*",Y[k-1]))
} else{
res1=c(res1,Y[k-1])
}
}
}
}
}
} else if(depx==TRUE){
count=length(bmatrix)
count
if(count==1) {
xcount=1
} else if(count==3) {
xcount=2
} else if(count==6) {
xcount=3
} else if(count==10) {
xcount=4
} else if(count==15) {
xcount=5
} else if(count==21) {
xcount=6
} else xcount=7
xcount
pos=1+sum(1:(xcount-1))
pos
bmatrix[pos]
if(bmatrix[pos]==1){
if(mode==0) {
res1=c(res1,paste0("c*",X))
} else{
res1=c(res1,X)
}
}
} else{
pos=1+sum(1:(xcount))
pos=pos+1
l=1
for(k in pos:length(bmatrix)){
if(bmatrix[k]==1){
if(mode==0) {
res1=c(res1,paste0("b",l,"*",X[l]))
} else{
res1=c(res1,X[l])
}
l=l+1
}
}
}
res1
if(length(res1)>0) temp=c(temp,paste0(Y[j],"~",paste0(res1,collapse="+")))
}
temp
eq=paste0(temp,collapse="\n")
eq
}
library(processR)
labels=list(X="X",M=c("M1","M2","M3"),Y="Y")
cat(multipleMediation(labels=labels,bmatrix=c(1,1,0,1,0,0,0,1,1,1)))
labels=list(X="X",M=c("M1","M2","M3"),Y="Y")
cat(multipleMediation(labels=labels,bmatrix=c(1,1,1,1,1,1,1,1,1,1)))
labels=list(X="X",M=c("M1","M2"),Y="Y")
cat(multipleMediation(labels=labels))
cat(multipleMediation(labels=labels,serial=TRUE))
moderator=list(name=c("W"),site=list(c("a1","b1")))
devtools::document()
devtools::check()
labels=list(X="X",M=c("M1","M2","M3"),Y="Y")
labels=list(X="X",M=c("M1","M2","M3"),Y="Y")
cat(multipleMediation(labels=labels,bmatrix=c(1,1,1,1,1,1,1,1,1,1),contrast=FALSE))
cat(multipleMediation(labels=labels,bmatrix=c(1,1,1,1,1,1,1,1,1,1),contrast=0))
cat(multipleMediation(labels=labels,bmatrix=c(1,1,1,1,1,1,1,1,1,1),mode=0))
labels=list(X="X",M=c("M1","M2","M3"),Y="Y")
cat(multipleMediation(labels=labels,bmatrix=c(1,1,1,1,1,1,1,1,1,1),mode=0))
cat(multipleMediation(labels=labels,bmatrix=c(1,1,1,1,1,1,1,1,1,1),mode=1))
labels=list(X="X",M=c("M1","M2","M3"),Y="Y")
eq=multipleMediation(labels=labels,bmatrix=c(1,1,0,1,0,0,1,1,1,1),mode=1)
eq
drawModel(eq)
drawModel(equation=eq)
drawModel(equation=eq,parallel=TRUE)
labels=list(X="X",M=c("M1","M2"),Y="Y")
eq=multipleMediation(labels=labels,bmatrix=c(1,1,0,0,0,1),mode=1)
eq
drawModel(equation=eq,parallel=TRUE)
drawModel(equation=eq)
labels=list(X="X",M=c("M1","M2"),Y="Y")
eq=multipleMediation(labels=labels,bmatrix=c(1,1,1,0,0,1),mode=1)
eq
drawModel(equation=eq)
labels=list(X="X",M=c("M1","M2"),Y="Y")
eq=multipleMediation(labels=labels,bmatrix=c(1,1,1,0,0,1),mode=1)
eq
drawModel(equation=eq)
labels=list(X="X",M=c("M1","M2"),Y="Y")
eq=multipleMediation(labels=labels,bmatrix=c(1,1,1,1,1,1),mode=1)
eq
drawModel(equation=eq)
labels=list(X="X",M=c("M1","M2"),Y="Y")
eq=multipleMediation(labels=labels,bmatrix=c(1,1,1,0,1,0),mode=1)
eq
drawModel(equation=eq)
labels=list(X="X",M=c("M1","M2"),Y="Y")
eq=multipleMediation(labels=labels,bmatrix=c(1,1,1,0,0,1),mode=1)
eq
drawModel(equation=eq)
cat(makeCatEquation3(X=c("M1","M2"),Y="Y",prefix="a",bmatrix=c(1,1,1,0,0,1),depy=TRUE))
cat(makeCatEquation3(X=c("M1","M2"),Y="Y",prefix="a",bmatrix=c(1,1,1,0,0,1),depy=TRUE))
cat(makeCatEquation3(X=c("M1","M2"),Y="Y",prefix="a",bmatrix=c(1,1,1,0,1,1),depy=TRUE))
cat(makeCatEquation3(X=c("M1","M2"),Y="Y",prefix="a",bmatrix=c(1,1,1,0,1,0),depy=TRUE))
# X="X";Y=c("M1","M2","M3");W=NULL;labels=list();prefix="a";mode=0;pos=list();
# bmatrix=c(1,1,0,1,1,0,1,1,1,1);depy=FALSE
# bmatrix=c(1,1,1,1,1,1,1,1,1,1);depy=FALSE
# X=c("M1","M2","M3");Y="Y";W=NULL;labels=list();prefix="a";mode=0;pos=list();
# bmatrix=c(1,1,1,1,1,1,0,1,1,1);depy=TRUE
# X="X";Y="Y";W=NULL;prefix="a";bmatrix=c(1,1,1,1,1,1,0,1,1,1);depy=TRUE;depx=TRUE;mode=0;pos=list()
X=c("M1","M2");Y="Y";prefix="a";bmatrix=c(1,1,1,0,0,1);depy=TRUE;depx=FALSE;labels=list();mode=1
if(is.null(X)) X=labels$X
if(is.null(W)) if(!is.null(labels$W)) W=labels$W
if(is.null(Y)) Y=labels$Y
xgroup<-wgroup<-c()
xcount<-wcount<-ycount<-0
xcount=length(X)
wcount=length(W)
ycount=length(Y)
temp=c()
j=1
for(j in 1:ycount){
res1=c()
if(depy==FALSE){
for(i in 1:xcount){
res=c()
res=c(res,X[i])
for(l in seq_along(W)){
if(length(pos)==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(length(pos[[l]])==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(i %in% pos[[l]]){
res=c(res,W[l],paste0(X[i],":",W[l]))
}
}
if(mode==0){
temp1=c()
for(k in 1:length(res)){
temp1=c(temp1,paste0(prefix,ifelse(xcount>1,i,""),
ifelse(ycount>1,j,""),"*",res[k]))
}
} else{
temp1=res
}
res1=c(res1,temp1)
if(j>1){
for(k in 2:j){
pos=1+sum(1:(j-1))+(k-1)
# cat("j=",j,",k=",k,"\n")
# cat("pos=",pos,",bmatrix[pos]=",bmatrix[pos],"\n")
if(bmatrix[pos]==1){
if(mode==0) {
res1=c(res1,paste0("d",j,k-1,"*",Y[k-1]))
} else{
res1=c(res1,Y[k-1])
}
}
}
}
}
} else if(depx==TRUE){
count=length(bmatrix)
count
if(count==1) {
xcount=1
} else if(count==3) {
xcount=2
} else if(count==6) {
xcount=3
} else if(count==10) {
xcount=4
} else if(count==15) {
xcount=5
} else if(count==21) {
xcount=6
} else xcount=7
xcount
pos=1+sum(1:(xcount-1))
pos
bmatrix[pos]
if(bmatrix[pos]==1){
if(mode==0) {
res1=c(res1,paste0("c*",X))
} else{
res1=c(res1,X)
}
}
} else{
pos=1+sum(1:(xcount))
pos=pos+1
l=1
for(k in pos:length(bmatrix)){
if(bmatrix[k]==1){
if(mode==0) {
res1=c(res1,paste0("b",l,"*",X[l]))
} else{
res1=c(res1,X[l])
}
l=l+1
}
}
}
res1
if(length(res1)>0) temp=c(temp,paste0(Y[j],"~",paste0(res1,collapse="+")))
}
temp
# X="X";Y=c("M1","M2","M3");W=NULL;labels=list();prefix="a";mode=0;pos=list();
# bmatrix=c(1,1,0,1,1,0,1,1,1,1);depy=FALSE
# bmatrix=c(1,1,1,1,1,1,1,1,1,1);depy=FALSE
# X=c("M1","M2","M3");Y="Y";W=NULL;labels=list();prefix="a";mode=0;pos=list();
# bmatrix=c(1,1,1,1,1,1,0,1,1,1);depy=TRUE
# X="X";Y="Y";W=NULL;prefix="a";bmatrix=c(1,1,1,1,1,1,0,1,1,1);depy=TRUE;depx=TRUE;mode=0;pos=list()
X=c("M1","M2");Y="Y";prefix="a";bmatrix=c(1,1,1,0,0,1);depy=TRUE;depx=FALSE;labels=list();mode=1
if(is.null(X)) X=labels$X
if(is.null(W)) if(!is.null(labels$W)) W=labels$W
if(is.null(Y)) Y=labels$Y
xgroup<-wgroup<-c()
xcount<-wcount<-ycount<-0
xcount=length(X)
wcount=length(W)
ycount=length(Y)
temp=c()
j=1
for(j in 1:ycount){
res1=c()
if(depy==FALSE){
for(i in 1:xcount){
res=c()
res=c(res,X[i])
for(l in seq_along(W)){
if(length(pos)==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(length(pos[[l]])==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(i %in% pos[[l]]){
res=c(res,W[l],paste0(X[i],":",W[l]))
}
}
if(mode==0){
temp1=c()
for(k in 1:length(res)){
temp1=c(temp1,paste0(prefix,ifelse(xcount>1,i,""),
ifelse(ycount>1,j,""),"*",res[k]))
}
} else{
temp1=res
}
res1=c(res1,temp1)
if(j>1){
for(k in 2:j){
pos=1+sum(1:(j-1))+(k-1)
cat("j=",j,",k=",k,"\n")
cat("pos=",pos,",bmatrix[pos]=",bmatrix[pos],"\n")
if(bmatrix[pos]==1){
if(mode==0) {
res1=c(res1,paste0("d",j,k-1,"*",Y[k-1]))
} else{
res1=c(res1,Y[k-1])
}
}
}
}
}
} else if(depx==TRUE){
count=length(bmatrix)
count
if(count==1) {
xcount=1
} else if(count==3) {
xcount=2
} else if(count==6) {
xcount=3
} else if(count==10) {
xcount=4
} else if(count==15) {
xcount=5
} else if(count==21) {
xcount=6
} else xcount=7
xcount
pos=1+sum(1:(xcount-1))
pos
bmatrix[pos]
if(bmatrix[pos]==1){
if(mode==0) {
res1=c(res1,paste0("c*",X))
} else{
res1=c(res1,X)
}
}
} else{
pos=1+sum(1:(xcount))
pos=pos+1
l=1
for(k in pos:length(bmatrix)){
if(bmatrix[k]==1){
if(mode==0) {
res1=c(res1,paste0("b",l,"*",X[l]))
} else{
res1=c(res1,X[l])
}
l=l+1
}
}
}
res1
if(length(res1)>0) temp=c(temp,paste0(Y[j],"~",paste0(res1,collapse="+")))
}
temp
eq=paste0(temp,collapse="\n")
eq
# X="X";Y=c("M1","M2","M3");W=NULL;labels=list();prefix="a";mode=0;pos=list();
# bmatrix=c(1,1,0,1,1,0,1,1,1,1);depy=FALSE
# bmatrix=c(1,1,1,1,1,1,1,1,1,1);depy=FALSE
# X=c("M1","M2","M3");Y="Y";W=NULL;labels=list();prefix="a";mode=0;pos=list();
# bmatrix=c(1,1,1,1,1,1,0,1,1,1);depy=TRUE
# X="X";Y="Y";W=NULL;prefix="a";bmatrix=c(1,1,1,1,1,1,0,1,1,1);depy=TRUE;depx=TRUE;mode=0;pos=list()
X=c("M1","M2");Y="Y";prefix="a";bmatrix=c(1,1,1,0,0,1);depy=TRUE;depx=FALSE;labels=list();mode=0
if(is.null(X)) X=labels$X
if(is.null(W)) if(!is.null(labels$W)) W=labels$W
if(is.null(Y)) Y=labels$Y
xgroup<-wgroup<-c()
xcount<-wcount<-ycount<-0
xcount=length(X)
wcount=length(W)
ycount=length(Y)
temp=c()
j=1
for(j in 1:ycount){
res1=c()
if(depy==FALSE){
for(i in 1:xcount){
res=c()
res=c(res,X[i])
for(l in seq_along(W)){
if(length(pos)==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(length(pos[[l]])==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(i %in% pos[[l]]){
res=c(res,W[l],paste0(X[i],":",W[l]))
}
}
if(mode==0){
temp1=c()
for(k in 1:length(res)){
temp1=c(temp1,paste0(prefix,ifelse(xcount>1,i,""),
ifelse(ycount>1,j,""),"*",res[k]))
}
} else{
temp1=res
}
res1=c(res1,temp1)
if(j>1){
for(k in 2:j){
pos=1+sum(1:(j-1))+(k-1)
cat("j=",j,",k=",k,"\n")
cat("pos=",pos,",bmatrix[pos]=",bmatrix[pos],"\n")
if(bmatrix[pos]==1){
if(mode==0) {
res1=c(res1,paste0("d",j,k-1,"*",Y[k-1]))
} else{
res1=c(res1,Y[k-1])
}
}
}
}
}
} else if(depx==TRUE){
count=length(bmatrix)
count
if(count==1) {
xcount=1
} else if(count==3) {
xcount=2
} else if(count==6) {
xcount=3
} else if(count==10) {
xcount=4
} else if(count==15) {
xcount=5
} else if(count==21) {
xcount=6
} else xcount=7
xcount
pos=1+sum(1:(xcount-1))
pos
bmatrix[pos]
if(bmatrix[pos]==1){
if(mode==0) {
res1=c(res1,paste0("c*",X))
} else{
res1=c(res1,X)
}
}
} else{
pos=1+sum(1:(xcount))
pos=pos+1
l=1
for(k in pos:length(bmatrix)){
if(bmatrix[k]==1){
if(mode==0) {
res1=c(res1,paste0("b",l,"*",X[l]))
} else{
res1=c(res1,X[l])
}
l=l+1
}
}
}
res1
if(length(res1)>0) temp=c(temp,paste0(Y[j],"~",paste0(res1,collapse="+")))
}
temp
cat(makeCatEquation3(X=c("M1","M2"),Y="Y",prefix="a",bmatrix=c(1,1,1,0,1,0),depy=TRUE))
library(processR)
devtools::document()
devtools::check()
