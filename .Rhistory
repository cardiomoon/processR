modelsSummary2(fit)
labels=list(X="protest",W="sexism",Y="liking")
getCatSlopeDf(labels=labels,data=protest)
model=makeCatEquation(labels=labels,data=protest)
model
fit=makeCatModel(labels=labels,data=protest)
modelsSummary2(fit)
makeCatEquation(labels=labels,data=protest,mode=2)
getCatSlopeDf(labels=labels,data=protest)
labels=list(X="protest",W="sexism",Y="liking")
data=protest;add.label=FALSE;maxylev=6
fit=makeCatModel(labels=labels,data=data)
X=labels$X
W=labels$W
Y=labels$Y
if(length(unique(data[[X]]))<=maxylev) catVar="X"
if(length(unique(data[[W]]))<=maxylev) catVar="W"
if(catVar=="W"){
W=labels$X
X=labels$W
}
model=makeCatEquation(labels=labels,data=data)
model
count=length(unique(data[[X]]))
ratio=getRatioTable(count)
ratio
colnames(ratio)=paste0("D",1:(count-1))
eq=unlist(strsplit(model,"~"))[2]
eq
eq=str_replace_all(eq,":","*")
eq=str_replace_all(eq,W,"W")
eq=paste0("b0+",eq)
eq1=unlist(strsplit(eq,"\\+"))
eq1
equation=intercept=slope=ceslope=ceintercept=ce=list()
i=2
temp=eq1
temp
ncol(ratio)
for(j in 1:ncol(ratio)){
if(ratio[i,j]==0) temp=temp[!str_detect(temp,colnames(ratio)[j])]
}
temp
if(i==1){
temp2=temp
} else{
group=paste0("D",(i-1))
temp1=temp[str_detect(temp,group)]
temp2=strGrouping(temp1,group)$yes
}
temp2
i=1
temp=eq1
temp
ncol(ratio)
for(j in 1:ncol(ratio)){
if(ratio[i,j]==0) temp=temp[!str_detect(temp,colnames(ratio)[j])]
}
temp
temp2=setdiff(temp,"b0")
temp2
#' Make data summarizing regression slopes and intercepts
#' @param labels Named list of variables
#' @param data A data.frame
#' @param add.label logical
#' @param maxylev maximal unique length of categorical variable
#' @export
#' @examples
#' labels=list(X="protest",W="sexism",Y="liking")
#' getCatSlopeDf(labels=labels,data=protest)
getCatSlopeDf=function(labels=NULL,data,add.label=FALSE,maxylev=6){
# data=protest;add.label=FALSE;maxylev=6
fit=makeCatModel(labels=labels,data=data)
X=labels$X
W=labels$W
Y=labels$Y
if(length(unique(data[[X]]))<=maxylev) catVar="X"
if(length(unique(data[[W]]))<=maxylev) catVar="W"
if(catVar=="W"){
W=labels$X
X=labels$W
}
model=makeCatEquation(labels=labels,data=data)
model
count=length(unique(data[[X]]))
ratio=getRatioTable(count)
ratio
colnames(ratio)=paste0("D",1:(count-1))
eq=unlist(strsplit(model,"~"))[2]
eq
eq=str_replace_all(eq,":","*")
eq=str_replace_all(eq,W,"W")
eq=paste0("b0+",eq)
eq1=unlist(strsplit(eq,"\\+"))
eq1
equation=intercept=slope=ceslope=ceintercept=ce=list()
# i=1
for(i in 1:count){
temp=eq1
temp
ncol(ratio)
for(j in 1:ncol(ratio)){
if(ratio[i,j]==0) temp=temp[!str_detect(temp,colnames(ratio)[j])]
}
temp
if(i==1){
temp2=setdiff(temp,"b0")
} else{
group=paste0("D",(i-1))
temp1=temp[str_detect(temp,group)]
temp2=strGrouping(temp1,group)$yes
}
temp2
ce[[i]]=paste0(temp2,collapse="+")
ceintercept[[i]]=temp2[!str_detect(temp2,"W")]
ceslope[[i]]=temp2[str_detect(temp2,"W")]
for(j in 1:ncol(ratio)){
if(ratio[i,j]==1) temp=str_replace_all(temp,colnames(ratio)[j],"1")
}
temp=str_replace_all(temp,"\\*1","")
temp
intercept[[i]]=paste0(strGrouping(temp,"W")$no,collapse="+")
slope[[i]]=paste0(strGrouping(temp,"W")$yes,collapse="+")
equation[[i]]=paste0(temp,collapse="+")
}
for(i in 1:length(fit$coef)){
assign(paste0("b",i-1),fit$coef[i])
}
slope
intercept
ce
ceslope
ceintercept
ceslope=str_replace_all(ceslope,"\\*W","")
ceintercept=unlist(lapply(ceintercept,function(x){eval(parse(text=x))}))
ceslope=unlist(lapply(ceslope,function(x){eval(parse(text=x))}))
slope1=unlist(lapply(slope,function(x){eval(parse(text=x))}))
intercept1=unlist(lapply(intercept,function(x){eval(parse(text=x))}))
ceslope
ce=unlist(ce)
ce
df=data.frame(slope=slope1,intercept=intercept1,ce=ce,ceslope=ceslope,ceintercept=ceintercept)
df
if(add.label) {
df$label=paste0(sprintf("%0.3f",df$intercept),ifelse(df$slope>=0," + "," - "),
sprintf("%0.3f",abs(df$slope)),"*italic(W)")
} else{
df$label=""
}
df
}
labels=list(X="protest",W="sexism",Y="liking")
getCatSlopeDf(labels=labels,data=protest)
labels=list(X="protest",W="sexism",Y="liking")
data=protest;add.label=FALSE;maxylev=6
fit=makeCatModel(labels=labels,data=data)
X=labels$X
W=labels$W
Y=labels$Y
if(length(unique(data[[X]]))<=maxylev) catVar="X"
if(length(unique(data[[W]]))<=maxylev) catVar="W"
if(catVar=="W"){
W=labels$X
X=labels$W
}
model=makeCatEquation(labels=labels,data=data)
model
count=length(unique(data[[X]]))
ratio=getRatioTable(count)
ratio
colnames(ratio)=paste0("D",1:(count-1))
eq=unlist(strsplit(model,"~"))[2]
eq
eq=str_replace_all(eq,":","*")
eq=str_replace_all(eq,W,"W")
eq=paste0("b0+",eq)
eq1=unlist(strsplit(eq,"\\+"))
eq1
equation=intercept=slope=ceslope=ceintercept=ce=list()
# i=1
for(i in 1:count){
temp=eq1
temp
ncol(ratio)
for(j in 1:ncol(ratio)){
if(ratio[i,j]==0) temp=temp[!str_detect(temp,colnames(ratio)[j])]
}
temp
if(i==1){
temp2=setdiff(temp,"b0")
} else{
group=paste0("D",(i-1))
temp1=temp[str_detect(temp,group)]
temp2=strGrouping(temp1,group)$yes
}
temp2
ce[[i]]=paste0(temp2,collapse="+")
ceintercept[[i]]=temp2[!str_detect(temp2,"W")]
ceslope[[i]]=temp2[str_detect(temp2,"W")]
for(j in 1:ncol(ratio)){
if(ratio[i,j]==1) temp=str_replace_all(temp,colnames(ratio)[j],"1")
}
temp=str_replace_all(temp,"\\*1","")
temp
intercept[[i]]=paste0(strGrouping(temp,"W")$no,collapse="+")
slope[[i]]=paste0(strGrouping(temp,"W")$yes,collapse="+")
equation[[i]]=paste0(temp,collapse="+")
}
for(i in 1:length(fit$coef)){
assign(paste0("b",i-1),fit$coef[i])
}
slope
intercept
ce
ceslope
ceintercept
#' Make data summarizing regression slopes and intercepts
#' @param labels Named list of variables
#' @param data A data.frame
#' @param add.label logical
#' @param maxylev maximal unique length of categorical variable
#' @export
#' @examples
#' labels=list(X="protest",W="sexism",Y="liking")
#' getCatSlopeDf(labels=labels,data=protest)
getCatSlopeDf=function(labels=NULL,data,add.label=FALSE,maxylev=6){
# data=protest;add.label=FALSE;maxylev=6
fit=makeCatModel(labels=labels,data=data)
X=labels$X
W=labels$W
Y=labels$Y
if(length(unique(data[[X]]))<=maxylev) catVar="X"
if(length(unique(data[[W]]))<=maxylev) catVar="W"
if(catVar=="W"){
W=labels$X
X=labels$W
}
model=makeCatEquation(labels=labels,data=data)
model
count=length(unique(data[[X]]))
ratio=getRatioTable(count)
ratio
colnames(ratio)=paste0("D",1:(count-1))
eq=unlist(strsplit(model,"~"))[2]
eq
eq=str_replace_all(eq,":","*")
eq=str_replace_all(eq,W,"W")
eq=paste0("b0+",eq)
eq1=unlist(strsplit(eq,"\\+"))
eq1
equation=intercept=slope=ceslope=ceintercept=ce=list()
# i=1
for(i in 1:count){
temp=eq1
temp
ncol(ratio)
for(j in 1:ncol(ratio)){
if(ratio[i,j]==0) temp=temp[!str_detect(temp,colnames(ratio)[j])]
}
temp
if(i==1){
temp2=setdiff(temp,"b0")
} else{
group=paste0("D",(i-1))
temp1=temp[str_detect(temp,group)]
temp2=strGrouping(temp1,group)$yes
}
temp2
ce[[i]]=paste0(temp2,collapse="+")
if(i==1) {
ceintercept[[i]]=NA
} else{
ceintercept[[i]]=temp2[!str_detect(temp2,"W")]
}
ceslope[[i]]=temp2[str_detect(temp2,"W")]
for(j in 1:ncol(ratio)){
if(ratio[i,j]==1) temp=str_replace_all(temp,colnames(ratio)[j],"1")
}
temp=str_replace_all(temp,"\\*1","")
temp
intercept[[i]]=paste0(strGrouping(temp,"W")$no,collapse="+")
slope[[i]]=paste0(strGrouping(temp,"W")$yes,collapse="+")
equation[[i]]=paste0(temp,collapse="+")
}
for(i in 1:length(fit$coef)){
assign(paste0("b",i-1),fit$coef[i])
}
slope
intercept
ce
ceslope
ceintercept
ceslope=str_replace_all(ceslope,"\\*W","")
ceintercept=unlist(lapply(ceintercept,function(x){eval(parse(text=x))}))
ceslope=unlist(lapply(ceslope,function(x){eval(parse(text=x))}))
slope1=unlist(lapply(slope,function(x){eval(parse(text=x))}))
intercept1=unlist(lapply(intercept,function(x){eval(parse(text=x))}))
ceslope
ce=unlist(ce)
ce
df=data.frame(slope=slope1,intercept=intercept1,ce=ce,ceslope=ceslope,ceintercept=ceintercept)
df
if(add.label) {
df$label=paste0(sprintf("%0.3f",df$intercept),ifelse(df$slope>=0," + "," - "),
sprintf("%0.3f",abs(df$slope)),"*italic(W)")
} else{
df$label=""
}
df
}
labels=list(X="protest",W="sexism",Y="liking")
getCatSlopeDf(labels=labels,data=protest)
labels=list(X="protest",W="sexism",Y="liking")
fit=makeCatModel(labels=labels,data=protest)
modelsSummary2(fit)
getCatSlopeDf(labels=labels,data=protest)
labels=list(W="protest",X="sexism",Y="liking")
condPlotCat(labels=labels,data=protest,catlabels=catlabels,add.slopelabel=TRUE,xpos=c(0.3,0.7,0.7),add.point=FALSE,add.vlines=FALSE,add.anova=FALSE,add.arrow=FALSE)
labels=list(W="protest",X="sexism",Y="liking")
getCatSlopeDf(labels=labels,data=protest)
labels=list(W="protest",X="sexism",Y="liking")
makeCatEquation(labels=labels,data=protest,mode=2)
fit=makeCatModel(labels=labels,data=protest)
modelsSummary2(fit)
getCatSlopeDf(labels=labels,data=protest)
labels=list(W="protest",X="sexism",Y="liking")
fit=makeCatModel(labels=labels,data=protest)
modelsSummary2(fit)
getCatSlopeDf(labels=labels,data=protest)
labels=list(W="protest",X="sexism",Y="liking")
data=protest;add.label=FALSE;maxylev=6
fit=makeCatModel(labels=labels,data=data)
X=labels$X
W=labels$W
Y=labels$Y
if(length(unique(data[[X]]))<=maxylev) catVar="X"
if(length(unique(data[[W]]))<=maxylev) catVar="W"
catVar
if(catVar=="W"){
W=labels$X
X=labels$W
}
model=makeCatEquation(labels=labels,data=data)
model
count=length(unique(data[[X]]))
ratio=getRatioTable(count)
ratio
colnames(ratio)=paste0("D",1:(count-1))
eq=unlist(strsplit(model,"~"))[2]
eq
eq=str_replace_all(eq,":","*")
eq
eq=str_replace_all(eq,W,catVar)
eq=paste0("b0+",eq)
eq1=unlist(strsplit(eq,"\\+"))
eq1
eq=str_replace_all(eq,W,"W")
eq=paste0("b0+",eq)
eq1=unlist(strsplit(eq,"\\+"))
eq1
equation=intercept=slope=ceslope=ceintercept=ce=list()
eq=unlist(strsplit(model,"~"))[2]
eq
eq=str_replace_all(eq,":","*")
eq=str_replace_all(eq,W,"W")
eq=paste0("b0+",eq)
eq1=unlist(strsplit(eq,"\\+"))
eq1
equation=intercept=slope=ceslope=ceintercept=ce=list()
# i=1
for(i in 1:count){
temp=eq1
temp
ncol(ratio)
for(j in 1:ncol(ratio)){
if(ratio[i,j]==0) temp=temp[!str_detect(temp,colnames(ratio)[j])]
}
temp
if(i==1){
temp2=setdiff(temp,"b0")
} else{
group=paste0("D",(i-1))
temp1=temp[str_detect(temp,group)]
temp2=strGrouping(temp1,group)$yes
}
temp2
ce[[i]]=paste0(temp2,collapse="+")
if(i==1) {
ceintercept[[i]]=NA
} else{
ceintercept[[i]]=temp2[!str_detect(temp2,"W")]
}
ceslope[[i]]=temp2[str_detect(temp2,"W")]
for(j in 1:ncol(ratio)){
if(ratio[i,j]==1) temp=str_replace_all(temp,colnames(ratio)[j],"1")
}
temp=str_replace_all(temp,"\\*1","")
temp
intercept[[i]]=paste0(strGrouping(temp,"W")$no,collapse="+")
slope[[i]]=paste0(strGrouping(temp,"W")$yes,collapse="+")
equation[[i]]=paste0(temp,collapse="+")
}
for(i in 1:length(fit$coef)){
assign(paste0("b",i-1),fit$coef[i])
}
slope
intercept
ce
#' Make data summarizing regression slopes and intercepts
#' @param labels Named list of variables
#' @param data A data.frame
#' @param add.label logical
#' @param maxylev maximal unique length of categorical variable
#' @export
#' @examples
#' labels=list(X="protest",W="sexism",Y="liking")
#' getCatSlopeDf(labels=labels,data=protest)
getCatSlopeDf=function(labels=NULL,data,add.label=FALSE,maxylev=6){
# labels=list(W="protest",X="sexism",Y="liking")
# data=protest;add.label=FALSE;maxylev=6
fit=makeCatModel(labels=labels,data=data)
X=labels$X
W=labels$W
Y=labels$Y
if(length(unique(data[[X]]))<=maxylev) catVar="X"
if(length(unique(data[[W]]))<=maxylev) catVar="W"
if(catVar=="W"){
W=labels$X
X=labels$W
}
model=makeCatEquation(labels=labels,data=data)
model
count=length(unique(data[[X]]))
ratio=getRatioTable(count)
ratio
colnames(ratio)=paste0("D",1:(count-1))
eq=unlist(strsplit(model,"~"))[2]
eq
eq=str_replace_all(eq,":","*")
eq=str_replace_all(eq,W,"W")
eq=paste0("b0+",eq)
eq1=unlist(strsplit(eq,"\\+"))
eq1
equation=intercept=slope=ceslope=ceintercept=ce=list()
# i=1
for(i in 1:count){
temp=eq1
temp
ncol(ratio)
for(j in 1:ncol(ratio)){
if(ratio[i,j]==0) temp=temp[!str_detect(temp,colnames(ratio)[j])]
}
temp
if(i==1){
temp2=setdiff(temp,"b0")
} else{
group=paste0("D",(i-1))
temp1=temp[str_detect(temp,group)]
temp2=strGrouping(temp1,group)$yes
}
temp2
ce[[i]]=paste0(temp2,collapse="+")
if(i==1) {
ceintercept[[i]]=NA
} else{
ceintercept[[i]]=temp2[!str_detect(temp2,"W")]
}
ceslope[[i]]=temp2[str_detect(temp2,"W")]
for(j in 1:ncol(ratio)){
if(ratio[i,j]==1) temp=str_replace_all(temp,colnames(ratio)[j],"1")
}
temp=str_replace_all(temp,"\\*1","")
temp
intercept[[i]]=paste0(strGrouping(temp,"W")$no,collapse="+")
slope[[i]]=paste0(strGrouping(temp,"W")$yes,collapse="+")
equation[[i]]=paste0(temp,collapse="+")
}
for(i in 1:length(fit$coef)){
assign(paste0("b",i-1),fit$coef[i])
}
slope
intercept
if(catVar=="W") ce=slope
ceslope
ceintercept
ceslope=str_replace_all(ceslope,"\\*W","")
ceintercept=unlist(lapply(ceintercept,function(x){eval(parse(text=x))}))
ceslope=unlist(lapply(ceslope,function(x){eval(parse(text=x))}))
slope1=unlist(lapply(slope,function(x){eval(parse(text=x))}))
intercept1=unlist(lapply(intercept,function(x){eval(parse(text=x))}))
ceslope
ce=unlist(ce)
ce
df=data.frame(slope=slope1,intercept=intercept1,ce=ce,ceslope=ceslope,ceintercept=ceintercept)
df
if(add.label) {
df$label=paste0(sprintf("%0.3f",df$intercept),ifelse(df$slope>=0," + "," - "),
sprintf("%0.3f",abs(df$slope)),"*italic(W)")
} else{
df$label=""
}
df
}
labels=list(W="protest",X="sexism",Y="liking")
getCatSlopeDf(labels=labels,data=protest)
Y
labels=list(X="protest",W="sexism",Y="liking")
getCatSlopeDf(labels=labels,data=protest)
library(processR)
devtools::document()
devtools::check()
library(processR)
