df1=eq2df(eq1)
df2=eq2df(eq2)
df=dplyr::left_join(df1,df2,by="V1")
colnames(df)=c("Y","X1","X2")
df$eq=paste0(df$Y,"~",df$X1,"+",df$X2)
paste0(df$eq,collpase="\n")
}
eq2df=function(eq){
as.data.frame(matrix(unlist(lapply(unlist(strsplit(eq,"\n")),strsplit,"~")),ncol=2,byrow=TRUE))
}
sumEquation=function(eq1,eq2){
df1=eq2df(eq1)
df2=eq2df(eq2)
df=dplyr::left_join(df1,df2,by="V1")
colnames(df)=c("Y","X1","X2")
df$eq=paste0(df$Y,"~",df$X1,"+",df$X2)
paste0(df$eq,collpase="\n")
}
#' @param X Name of independent variable
#' @param Y Name of dependent variable
#' @param M Name of mediator variable
#' @param cat Which variable is categorical? Choices are c("X","Y")
#' @param moderator A list
#' @param data A data.frame
#' @param count length of unique values of categorical variable
#' @examples
#' moderator=list(name=c("W"),site=list(c("a","c")))
#'
catMediation=function(X="X",M="M",Y="Y",cat="X",count=NULL,data=NULL,moderator=list(),maxylev=6){
# X="X";M="M";Y="Y";cat="X";count=4;data=NULL;moderator=list();maxylev=6
# moderator=list(name=c("W"),site=list(c("a","c")))
#
res=c()
if(is.null(cat)){
if(!is.null(data)){
xcount=length(unique(data[[X]]))
mcount=length(unique(data[[M]]))
if(is.factor(data[[X]])) cat="X"
else if(xcount<=maxylev) cat="X"
else if(is.factor(data[[M]])) cat="M"
else if(mcount<=maxylev) cat="M"
else cat=NULL
}
}
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
if(cat=="X"){
eq1=catEquation(X=X,Y=M,cat="X",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="X",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else if(cat=="M"){
eq1=catEquation(X=X,Y=M,cat="Y",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat="X",W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat=NULL,W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else if(cat=="Y"){
eq1=catEquation(X=X,Y=M,cat=NULL,W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat="Y",W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="Y",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else{
eq1=catEquation(X=X,Y=M,cat=NULL,W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat=NULL,W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
}
eq=sumEquation(eq2,eq3)
paste0(eq1,eq,collpase="\n")
}
moderator=list(name=c("W"),site=list(c("a","c")))
catMediation(cat="X")
#' @param count length of unique values of categorical variable
#' @param data A data.frame
#' @param prefix A prefix
#' @export
#' @examples
#' catEquation(count=4)
#' catEquation(W="W",count=4)
#' catEquation(W="W",cat="Y",count=4)
#' catEquation(X="cyl",Y="wt",data=mtcars)
#' catEquation(X="wt",Y="cyl",data=mtcars)
catEquation=function(X="A",Y="B",cat=NULL,W=NULL,count=NULL,data=NULL,prefix="c",maxylev=6){
res=c()
if(is.null(cat)){
if(!is.null(data)){
xcount=length(unique(data[[X]]))
ycount=length(unique(data[[Y]]))
if(is.factor(data[[X]])) cat="X"
else if(xcount<=maxylev) cat="X"
else if(is.factor(data[[Y]])) cat="Y"
else if(ycount<=maxylev) cat="Y"
else cat=NULL
}
}
if(is.null(cat)){
if(length(W)>0) {
res=c(paste0(prefix,"1*",X),paste0(prefix,"2*",W),paste0(prefix,"3*",X,":",W))
} else {
res=paste0(prefix,"1*",X)
}
eq=paste0(Y,"~",paste0(res,collapse="+"))
} else if(cat=="X"){
if(is.null(count)) count=length(unique(data[[X]]))
group=paste0("d",1:(count-1))
group
res=paste0(prefix,1:(count-1),"*",group)
res
if(length(W)>0){
res<-c(res,paste0(prefix,count,"*",W))
res1=paste0(prefix,(count+1):(2*count-1),"*",group,":",W)
res=c(res,res1)
}
res
eq=paste0(Y,"~",paste0(res,collapse="+"))
} else if(cat=="Y"){  ##cat=="Y"
if(is.null(count)) count=length(unique(data[[Y]]))
eq=c()
if(length(W)>0){
res=paste0(prefix,1:(count-1),"*",X)
res
eq=c(eq,paste0("d",1:(count-1),"~",res))
} else{
group=c(X,W,paste0(X,":",W))
res=c(paste0(prefix,1:((count-1)*3),"*",group))
res
for(i in 1:(count-1)){
start=3*(i-1)+1
end=3*i
eq=c(eq,paste0("d",i,"~",paste0(res[start:end],collapse="+")))
}
}
eq=paste0(eq,collapse="\n")
}
print(eq)
eq
}
#' @param X Name of independent variable
#' @param Y Name of dependent variable
#' @param M Name of mediator variable
#' @param cat Which variable is categorical? Choices are c("X","Y")
#' @param moderator A list
#' @param data A data.frame
#' @param count length of unique values of categorical variable
#' @examples
#' moderator=list(name=c("W"),site=list(c("a","c")))
#' catMediation(cat="X")
catMediation=function(X="X",M="M",Y="Y",cat="X",count=NULL,data=NULL,moderator=list(),maxylev=6){
X="X";M="M";Y="Y";cat="X";count=4;data=NULL;moderator=list();maxylev=6
moderator=list(name=c("W"),site=list(c("a","c")))
res=c()
if(is.null(cat)){
if(!is.null(data)){
xcount=length(unique(data[[X]]))
mcount=length(unique(data[[M]]))
if(is.factor(data[[X]])) cat="X"
else if(xcount<=maxylev) cat="X"
else if(is.factor(data[[M]])) cat="M"
else if(mcount<=maxylev) cat="M"
else cat=NULL
}
}
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
if(cat=="X"){
eq1=catEquation(X=X,Y=M,cat="X",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="X",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else if(cat=="M"){
eq1=catEquation(X=X,Y=M,cat="Y",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat="X",W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat=NULL,W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else if(cat=="Y"){
eq1=catEquation(X=X,Y=M,cat=NULL,W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat="Y",W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="Y",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else{
eq1=catEquation(X=X,Y=M,cat=NULL,W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat=NULL,W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
}
eq=sumEquation(eq2,eq3)
paste0(eq1,eq,collpase="\n")
}
eq2df=function(eq){
as.data.frame(matrix(unlist(lapply(unlist(strsplit(eq,"\n")),strsplit,"~")),ncol=2,byrow=TRUE))
}
sumEquation=function(eq1,eq2){
df1=eq2df(eq1)
df2=eq2df(eq2)
df=dplyr::left_join(df1,df2,by="V1")
colnames(df)=c("Y","X1","X2")
df$eq=paste0(df$Y,"~",df$X1,"+",df$X2)
paste0(df$eq,collpase="\n")
}
#' @param X Name of independent variable
#' @param Y Name of dependent variable
#' @param M Name of mediator variable
#' @param cat Which variable is categorical? Choices are c("X","Y")
#' @param moderator A list
#' @param data A data.frame
#' @param count length of unique values of categorical variable
#' @examples
#' moderator=list(name=c("W"),site=list(c("a","c")))
#' catMediation(cat="X")
catMediation=function(X="X",M="M",Y="Y",cat="X",count=NULL,data=NULL,moderator=list(),maxylev=6){
# X="X";M="M";Y="Y";cat="X";count=4;data=NULL;moderator=list();maxylev=6
# moderator=list(name=c("W"),site=list(c("a","c")))
res=c()
if(is.null(cat)){
if(!is.null(data)){
xcount=length(unique(data[[X]]))
mcount=length(unique(data[[M]]))
if(is.factor(data[[X]])) cat="X"
else if(xcount<=maxylev) cat="X"
else if(is.factor(data[[M]])) cat="M"
else if(mcount<=maxylev) cat="M"
else cat=NULL
}
}
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
if(cat=="X"){
eq1=catEquation(X=X,Y=M,cat="X",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="X",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else if(cat=="M"){
eq1=catEquation(X=X,Y=M,cat="Y",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat="X",W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat=NULL,W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else if(cat=="Y"){
eq1=catEquation(X=X,Y=M,cat=NULL,W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat="Y",W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="Y",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else{
eq1=catEquation(X=X,Y=M,cat=NULL,W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat=NULL,W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
}
eq=sumEquation(eq2,eq3)
paste0(eq1,eq,collpase="\n")
}
catMediation(cat="X")
X="X";M="M";Y="Y";cat="X";count=4;data=NULL;moderator=list();maxylev=6
moderator=list(name=c("W"),site=list(c("a","c")))
res=c()
if(is.null(cat)){
if(!is.null(data)){
xcount=length(unique(data[[X]]))
mcount=length(unique(data[[M]]))
if(is.factor(data[[X]])) cat="X"
else if(xcount<=maxylev) cat="X"
else if(is.factor(data[[M]])) cat="M"
else if(mcount<=maxylev) cat="M"
else cat=NULL
}
}
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
eq1=catEquation(X=X,Y=M,cat="X",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="X",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
(eq=sumEquation(eq2,eq3))
paste0(eq1,eq,collpase="\n")
paste0(eq1,eq,collapse="\n")
paste(eq1,eq,sep="\n")
#' @param X Name of independent variable
#' @param Y Name of dependent variable
#' @param M Name of mediator variable
#' @param cat Which variable is categorical? Choices are c("X","Y")
#' @param moderator A list
#' @param data A data.frame
#' @param count length of unique values of categorical variable
#' @examples
#' moderator=list(name=c("W"),site=list(c("a","c")))
#' catMediation(cat="X")
catMediation=function(X="X",M="M",Y="Y",cat="X",count=NULL,data=NULL,moderator=list(),maxylev=6){
# X="X";M="M";Y="Y";cat="X";count=4;data=NULL;moderator=list();maxylev=6
# moderator=list(name=c("W"),site=list(c("a","c")))
res=c()
if(is.null(cat)){
if(!is.null(data)){
xcount=length(unique(data[[X]]))
mcount=length(unique(data[[M]]))
if(is.factor(data[[X]])) cat="X"
else if(xcount<=maxylev) cat="X"
else if(is.factor(data[[M]])) cat="M"
else if(mcount<=maxylev) cat="M"
else cat=NULL
}
}
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
if(cat=="X"){
eq1=catEquation(X=X,Y=M,cat="X",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="X",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else if(cat=="M"){
eq1=catEquation(X=X,Y=M,cat="Y",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat="X",W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat=NULL,W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else if(cat=="Y"){
eq1=catEquation(X=X,Y=M,cat=NULL,W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat="Y",W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="Y",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else{
eq1=catEquation(X=X,Y=M,cat=NULL,W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat=NULL,W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
}
(eq=sumEquation(eq2,eq3))
paste(eq1,eq,sep="\n")
}
cat(catMediation(cat="X"))
X="X";M="M";Y="Y";cat="X";count=4;data=NULL;moderator=list();maxylev=6
X="X";M="M";Y="Y";cat="X";count=4;data=NULL;moderator=list();maxylev=6
res=c()
if(is.null(cat)){
if(!is.null(data)){
xcount=length(unique(data[[X]]))
mcount=length(unique(data[[M]]))
if(is.factor(data[[X]])) cat="X"
else if(xcount<=maxylev) cat="X"
else if(is.factor(data[[M]])) cat="M"
else if(mcount<=maxylev) cat="M"
else cat=NULL
}
}
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
eq1=catEquation(X=X,Y=M,cat="X",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="X",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
#' @param X Name of independent variable
#' @param Y Name of dependent variable
#' @param M Name of mediator variable
#' @param cat Which variable is categorical? Choices are c("X","Y")
#' @param moderator A list
#' @param data A data.frame
#' @param count length of unique values of categorical variable
#' @examples
#' moderator=list(name=c("W"),site=list(c("a","c")))
#' cat(catMediation(cat="X",count=4))
catMediation=function(X="X",M="M",Y="Y",cat="X",count=NULL,data=NULL,moderator=list(),maxylev=6){
# X="X";M="M";Y="Y";cat="X";count=4;data=NULL;moderator=list();maxylev=6
# moderator=list(name=c("W"),site=list(c("a","c")))
res=c()
if(is.null(cat)){
if(!is.null(data)){
xcount=length(unique(data[[X]]))
mcount=length(unique(data[[M]]))
if(is.factor(data[[X]])) cat="X"
else if(xcount<=maxylev) cat="X"
else if(is.factor(data[[M]])) cat="M"
else if(mcount<=maxylev) cat="M"
else cat=NULL
}
}
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
if(cat=="X"){
eq1=catEquation(X=X,Y=M,cat="X",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="X",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else if(cat=="M"){
eq1=catEquation(X=X,Y=M,cat="Y",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat="X",W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat=NULL,W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else if(cat=="Y"){
eq1=catEquation(X=X,Y=M,cat=NULL,W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat="Y",W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="Y",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else{
eq1=catEquation(X=X,Y=M,cat=NULL,W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat=NULL,W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
}
(eq=sumEquation(eq2,eq3))
paste(eq1,eq,sep="\n")
}
cat(catMediation(cat="X",count=4))
#' @param count length of unique values of categorical variable
#' @param data A data.frame
#' @param prefix A prefix
#' @export
#' @examples
#' catEquation(count=4)
#' catEquation(W="W",count=4)
#' catEquation(W="W",cat="Y",count=4)
#' catEquation(X="cyl",Y="wt",data=mtcars)
#' catEquation(X="wt",Y="cyl",data=mtcars)
catEquation=function(X="A",Y="B",cat=NULL,W=NULL,count=NULL,data=NULL,prefix="c",maxylev=6){
res=c()
if(is.null(cat)){
if(!is.null(data)){
xcount=length(unique(data[[X]]))
ycount=length(unique(data[[Y]]))
if(is.factor(data[[X]])) cat="X"
else if(xcount<=maxylev) cat="X"
else if(is.factor(data[[Y]])) cat="Y"
else if(ycount<=maxylev) cat="Y"
else cat=NULL
}
}
if(is.null(cat)){
if(length(W)>0) {
res=c(paste0(prefix,"1*",X),paste0(prefix,"2*",W),paste0(prefix,"3*",X,":",W))
} else {
res=paste0(prefix,"1*",X)
}
eq=paste0(Y,"~",paste0(res,collapse="+"))
} else if(cat=="X"){
if(is.null(count)) count=length(unique(data[[X]]))
group=paste0("d",1:(count-1))
group
res=paste0(prefix,1:(count-1),"*",group)
res
if(length(W)>0){
res<-c(res,paste0(prefix,count,"*",W))
res1=paste0(prefix,(count+1):(2*count-1),"*",group,":",W)
res=c(res,res1)
}
res
eq=paste0(Y,"~",paste0(res,collapse="+"))
} else if(cat=="Y"){  ##cat=="Y"
if(is.null(count)) count=length(unique(data[[Y]]))
eq=c()
if(length(W)>0){
res=paste0(prefix,1:(count-1),"*",X)
res
eq=c(eq,paste0("d",1:(count-1),"~",res))
} else{
group=c(X,W,paste0(X,":",W))
res=c(paste0(prefix,1:((count-1)*3),"*",group))
res
for(i in 1:(count-1)){
start=3*(i-1)+1
end=3*i
eq=c(eq,paste0("d",i,"~",paste0(res[start:end],collapse="+")))
}
}
eq=paste0(eq,collapse="\n")
}
# print(eq)
eq
}
#' @param X Name of independent variable
#' @param Y Name of dependent variable
#' @param M Name of mediator variable
#' @param cat Which variable is categorical? Choices are c("X","Y")
#' @param moderator A list
#' @param data A data.frame
#' @param count length of unique values of categorical variable
#' @examples
#' moderator=list(name=c("W"),site=list(c("a","c")))
#' cat(catMediation(cat="X",count=4))
catMediation=function(X="X",M="M",Y="Y",cat="X",count=NULL,data=NULL,moderator=list(),maxylev=6){
# X="X";M="M";Y="Y";cat="X";count=4;data=NULL;moderator=list();maxylev=6
# moderator=list(name=c("W"),site=list(c("a","c")))
res=c()
if(is.null(cat)){
if(!is.null(data)){
xcount=length(unique(data[[X]]))
mcount=length(unique(data[[M]]))
if(is.factor(data[[X]])) cat="X"
else if(xcount<=maxylev) cat="X"
else if(is.factor(data[[M]])) cat="M"
else if(mcount<=maxylev) cat="M"
else cat=NULL
}
}
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
if(cat=="X"){
eq1=catEquation(X=X,Y=M,cat="X",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="X",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else if(cat=="M"){
eq1=catEquation(X=X,Y=M,cat="Y",W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat="X",W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat=NULL,W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else if(cat=="Y"){
eq1=catEquation(X=X,Y=M,cat=NULL,W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat="Y",W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat="Y",W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
} else{
eq1=catEquation(X=X,Y=M,cat=NULL,W=XM,count=count,data=data,prefix="a",maxylev=maxylev)
eq2=catEquation(X=M,Y=Y,cat=NULL,W=MY,count=count,data=data,prefix="b",maxylev=maxylev)
eq3=catEquation(X=X,Y=Y,cat=NULL,W=XY,count=count,data=data,prefix="c",maxylev=maxylev)
}
(eq=sumEquation(eq2,eq3))
paste(eq1,eq,sep="\n")
}
eq2df=function(eq){
as.data.frame(matrix(unlist(lapply(unlist(strsplit(eq,"\n")),strsplit,"~")),ncol=2,byrow=TRUE))
}
sumEquation=function(eq1,eq2){
df1=eq2df(eq1)
df2=eq2df(eq2)
df=dplyr::left_join(df1,df2,by="V1")
colnames(df)=c("Y","X1","X2")
df$eq=paste0(df$Y,"~",df$X1,"+",df$X2)
paste0(df$eq,collpase="\n")
}
moderator=list(name=c("W"),site=list(c("a","c")))
cat(catMediation(cat="X",count=4))
cat(catMediation(cat="M",count=4))
cat(catMediation(cat="Y",count=4))
