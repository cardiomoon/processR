for(i in 1:length(vars$name)){
for(j in 1:length(vars$site[[i]])){
vars$site[[i]][j]
if(vars$site[[i]][j]=="a") {
end=c("X","M")
} else if(vars$site[[i]][j]=="b") {
end=c("M","Y")
} else {
end=c("X","Y")
}
myarrow(vars$name[[i]][1],end,df=df,arr.pos=1)
myarrow(vars$name[[i]][2],c(vars$name[[i]][1],end),df=df,arr.pos=1)
}
}
for(i in 1:length(moderator$name)){
for(j in 1:length(moderator$site[[i]])){
if(moderator$site[[i]][j]=="a") {
end=c("X","M")
} else if(moderator$site[[i]][j]=="b") {
end=c("M","Y")
} else {
end=c("X","Y")
}
myarrow(moderator$name[i],end,df=df,arr.pos=1)
}
}
for(i in 1:nrow(df)){
mid=c(df$xpos[i],df$ypos[i])
textrect(mid,radx,rady,lab=df$name[i])
}
}
labels=list(X="X",M="M",Y="Y")
vars=list(name=list(c("W","Z")),site=list(c("a","b")))
moderator=list(name=c("W","V"),site=list(c("c"),c("b","c")))
#' Draw Concept Diagram
#' @examples
#' labels=list(X="X",M="M",Y="Y")
#' vars=list(name=list(c("W","Z")),site=list(c("a","b")))
#' moderator=list(name=c("W","V"),site=list(c("c"),c("b","c")))
#' drawModel2(labels=labels,vars=vars,moderator=moderator)
drawModel2=function(labels,vars=NULL,moderator=NULL,
xpos=c(0,0.5),mpos=c(0.5,0.9),ypos=c(1,0.5),minypos=0,maxypos=0.6,
node.pos=list(),serial=FALSE,radx=0.06,rady=0.06,
xmargin=0.01,ymargin=0.01) {
#xpos=c(0,0.5);mpos=c(0.5,0.9);ypos=c(1,0.5);minypos=0;maxypos=0.6
#node.pos=list()
#serial=FALSE
# radx=0.06
# rady=0.06
# xmargin=0.01
# ymargin=0.01
X<-M<-Y<-NULL
X=labels[["X"]]
xcount=length(X)
mcount=0
if(is.null(M)) {
M=labels[["M"]]
mcount=length(M)
}
Y=labels[["Y"]]
name=c(X,M,Y)
name
if(xcount==1){
xposition = xpos[1]
yposition = xpos[2]
} else{
xposition=seq(minypos,maxypos,length.out=xcount+1)[-1]
yposition=rep(xpos[2],xcount)
}
if(xcount==1){
xposition = xpos[1]
yposition = xpos[2]
} else{
xposition=seq(minypos,maxypos,length.out=xcount+1)[-1]
yposition=rep(xpos[2],xcount)
}
if(mcount>1) {
if(mcount==2){
mympos=seq(from=0.2,to=0.8,length.out=mcount)
} else{
mympos=seq(from=0.05,to=0.95,length.out=mcount)
}
for(i in 1:mcount){
labels[[paste0("M",i)]]=labels$M[i]
}
} else {
mympos=mpos[1]
}
xposition=c(xposition,mympos)
if(mcount>2){
starty=mpos[2]-0.12
yposition=c(yposition,starty,rep(mpos[2],mcount-2),starty)
} else{
yposition=c(yposition,mpos[2])
}
xposition=c(xposition,ypos[1])
yposition=c(yposition,ypos[2])
df=data.frame(name=name,xpos=xposition,ypos=yposition)
df
df1<-df2<-NULL
if(!is.null(vars)) df1=vars2df(vars,mpos)
if(!is.null(moderator)) df2=moderator2df(moderator=moderator,mpos,vars=vars)
df=rbind(df,df1,df2)
(xlim=c(min(df$xpos)-radx-xmargin,max(df$xpos)+radx+xmargin))
(ylim=c(min(df$ypos)-rady-ymargin,max(df$ypos)+rady+ymargin))
name2pos=function(name,df,pos=0.5){
if(length(name)==1) {
pos=c(df$xpos[df$name==name],df$ypos[df$name==name])
} else if(length(name)==2){
xpos1=df$xpos[df$name==name[1]]
xpos2=df$xpos[df$name==name[2]]
ypos1=df$ypos[df$name==name[1]]
ypos2=df$ypos[df$name==name[2]]
xpos=xpos1+(xpos2-xpos1)*pos
ypos=ypos1+(ypos2-ypos1)*pos
pos=c(xpos,ypos)
} else if(length(name)==3){
xpos1=df$xpos[df$name==name[1]]
xpos2=df$xpos[df$name==name[2]]
xpos3=df$xpos[df$name==name[3]]
ypos1=df$ypos[df$name==name[1]]
ypos2=df$ypos[df$name==name[2]]
ypos3=df$ypos[df$name==name[3]]
xpos4=xpos2+(xpos3-xpos2)*pos
ypos4=ypos2+(ypos3-ypos2)*pos
xpos=xpos1+(xpos4-xpos1)*0.5
ypos=ypos1+(ypos4-ypos1)*0.5
pos=c(xpos,ypos)
}
pos
}
myarrow=function(start,end,df,arr.pos=0.5,...){
from=name2pos(start,df=df)
to=name2pos(end,df=df)
if(arr.pos==1) {
res=from-to
length=sqrt(res[1]^2+res[2]^2)
arr.pos=1-(1-length)/10
} else if(arr.pos==-1){
res=from-to
length=sqrt(res[1]^2+res[2]^2)
res=abs(res)
# cat("res=",res,"\n")
ratio=max((res[1]-radx)/res[1],(res[2]-rady)/res[2])
arr.pos=ratio-0.025
# cat("arr.pos=",arr.pos,"\n")
}
straightarrow(from,to,arr.pos=arr.pos,lwd=1,arr.length=0.3,arr.type="triangle",...)
}
openplotmat(xlim=xlim,ylim=ylim)
myarrow("X","M",df=df,-1)
myarrow("M","Y",df=df,-1)
myarrow("X","Y",df=df,-1)
for(i in 1:length(vars$name)){
for(j in 1:length(vars$site[[i]])){
vars$site[[i]][j]
if(vars$site[[i]][j]=="a") {
end=c("X","M")
} else if(vars$site[[i]][j]=="b") {
end=c("M","Y")
} else {
end=c("X","Y")
}
myarrow(vars$name[[i]][1],end,df=df,arr.pos=1)
myarrow(vars$name[[i]][2],c(vars$name[[i]][1],end),df=df,arr.pos=1)
}
}
for(i in 1:length(moderator$name)){
for(j in 1:length(moderator$site[[i]])){
if(moderator$site[[i]][j]=="a") {
end=c("X","M")
} else if(moderator$site[[i]][j]=="b") {
end=c("M","Y")
} else {
end=c("X","Y")
}
myarrow(moderator$name[i],end,df=df,arr.pos=1)
}
}
for(i in 1:nrow(df)){
mid=c(df$xpos[i],df$ypos[i])
textrect(mid,radx,rady,lab=df$name[i])
}
}
drawModel2(labels=labels,vars=vars,moderator=moderator)
labels=list(X="X",M="M",Y="Y")
vars=list(name=list(c("W","Z")),site=list(c("a","b")))
moderator=list(name=c("W","V"),site=list(c("c"),c("b","c")))
drawModel2(labels=labels)
drawModel2(labels=labels,vars=vars)
drawModel2(labels=labels,moderator=moderator)
drawModel2(labels=labels,vars=vars,moderator=moderator)
drawModel2(labels=labels)
#' Draw Concept Diagram
#' @examples
#' labels=list(X="X",M="M",Y="Y")
#' vars=list(name=list(c("W","Z")),site=list(c("a","b")))
#' moderator=list(name=c("W","V"),site=list(c("c"),c("b","c")))
#' drawModel2(labels=labels)
#' drawModel2(labels=labels,vars=vars)
#' drawModel2(labels=labels,moderator=moderator)
#' drawModel2(labels=labels,vars=vars,moderator=moderator)
drawModel2=function(labels,vars=NULL,moderator=NULL,
xpos=c(0,0.5),mpos=c(0.5,0.9),ypos=c(1,0.5),minypos=0,maxypos=0.6,
node.pos=list(),serial=FALSE,radx=0.06,rady=0.06,
xmargin=0.01,ymargin=0.01) {
#xpos=c(0,0.5);mpos=c(0.5,0.9);ypos=c(1,0.5);minypos=0;maxypos=0.6
#node.pos=list()
#serial=FALSE
# radx=0.06
# rady=0.06
# xmargin=0.01
# ymargin=0.01
X<-M<-Y<-NULL
X=labels[["X"]]
xcount=length(X)
mcount=0
if(is.null(M)) {
M=labels[["M"]]
mcount=length(M)
}
Y=labels[["Y"]]
name=c(X,M,Y)
name
if(xcount==1){
xposition = xpos[1]
yposition = xpos[2]
} else{
xposition=seq(minypos,maxypos,length.out=xcount+1)[-1]
yposition=rep(xpos[2],xcount)
}
if(xcount==1){
xposition = xpos[1]
yposition = xpos[2]
} else{
xposition=seq(minypos,maxypos,length.out=xcount+1)[-1]
yposition=rep(xpos[2],xcount)
}
if(mcount>1) {
if(mcount==2){
mympos=seq(from=0.2,to=0.8,length.out=mcount)
} else{
mympos=seq(from=0.05,to=0.95,length.out=mcount)
}
for(i in 1:mcount){
labels[[paste0("M",i)]]=labels$M[i]
}
} else {
mympos=mpos[1]
}
xposition=c(xposition,mympos)
if(mcount>2){
starty=mpos[2]-0.12
yposition=c(yposition,starty,rep(mpos[2],mcount-2),starty)
} else{
yposition=c(yposition,mpos[2])
}
xposition=c(xposition,ypos[1])
yposition=c(yposition,ypos[2])
df=data.frame(name=name,xpos=xposition,ypos=yposition)
df
df1<-df2<-NULL
if(!is.null(vars)) df1=vars2df(vars,mpos)
if(!is.null(moderator)) df2=moderator2df(moderator=moderator,mpos,vars=vars)
df=rbind(df,df1,df2)
(xlim=c(min(df$xpos)-radx-xmargin,max(df$xpos)+radx+xmargin))
(ylim=c(min(df$ypos)-rady-ymargin,max(df$ypos)+rady+ymargin))
name2pos=function(name,df,pos=0.5){
if(length(name)==1) {
pos=c(df$xpos[df$name==name],df$ypos[df$name==name])
} else if(length(name)==2){
xpos1=df$xpos[df$name==name[1]]
xpos2=df$xpos[df$name==name[2]]
ypos1=df$ypos[df$name==name[1]]
ypos2=df$ypos[df$name==name[2]]
xpos=xpos1+(xpos2-xpos1)*pos
ypos=ypos1+(ypos2-ypos1)*pos
pos=c(xpos,ypos)
} else if(length(name)==3){
xpos1=df$xpos[df$name==name[1]]
xpos2=df$xpos[df$name==name[2]]
xpos3=df$xpos[df$name==name[3]]
ypos1=df$ypos[df$name==name[1]]
ypos2=df$ypos[df$name==name[2]]
ypos3=df$ypos[df$name==name[3]]
xpos4=xpos2+(xpos3-xpos2)*pos
ypos4=ypos2+(ypos3-ypos2)*pos
xpos=xpos1+(xpos4-xpos1)*0.5
ypos=ypos1+(ypos4-ypos1)*0.5
pos=c(xpos,ypos)
}
pos
}
myarrow=function(start,end,df,arr.pos=0.5,...){
from=name2pos(start,df=df)
to=name2pos(end,df=df)
if(arr.pos==1) {
res=from-to
length=sqrt(res[1]^2+res[2]^2)
arr.pos=1-(1-length)/10
} else if(arr.pos==-1){
res=from-to
length=sqrt(res[1]^2+res[2]^2)
res=abs(res)
# cat("res=",res,"\n")
ratio=max((res[1]-radx)/res[1],(res[2]-rady)/res[2])
arr.pos=ratio-0.025
# cat("arr.pos=",arr.pos,"\n")
}
straightarrow(from,to,arr.pos=arr.pos,lwd=1,arr.length=0.3,arr.type="triangle",...)
}
openplotmat(xlim=xlim,ylim=ylim)
myarrow("X","M",df=df,-1)
myarrow("M","Y",df=df,-1)
myarrow("X","Y",df=df,-1)
for(i in 1:length(vars$name)){
for(j in 1:length(vars$site[[i]])){
vars$site[[i]][j]
if(vars$site[[i]][j]=="a") {
end=c("X","M")
} else if(vars$site[[i]][j]=="b") {
end=c("M","Y")
} else {
end=c("X","Y")
}
myarrow(vars$name[[i]][1],end,df=df,arr.pos=1)
myarrow(vars$name[[i]][2],c(vars$name[[i]][1],end),df=df,arr.pos=1)
}
}
for(i in 1:length(moderator$name)){
for(j in 1:length(moderator$site[[i]])){
if(moderator$site[[i]][j]=="a") {
end=c("X","M")
} else if(moderator$site[[i]][j]=="b") {
end=c("M","Y")
} else {
end=c("X","Y")
}
myarrow(moderator$name[i],end,df=df,arr.pos=1)
}
}
for(i in 1:nrow(df)){
mid=c(df$xpos[i],df$ypos[i])
textrect(mid,radx,rady,lab=df$name[i])
}
}
#' Draw Concept Diagram
#' @examples
#' labels=list(X="X",M="M",Y="Y")
#' vars=list(name=list(c("W","Z")),site=list(c("a","b")))
#' moderator=list(name=c("W","V"),site=list(c("c"),c("b","c")))
#' drawModel2(labels=labels)
#' drawModel2(labels=labels,vars=vars)
#' drawModel2(labels=labels,moderator=moderator)
#' drawModel2(labels=labels,vars=vars,moderator=moderator)
drawModel2=function(labels,vars=NULL,moderator=NULL,
xpos=c(0,0.5),mpos=c(0.5,0.9),ypos=c(1,0.5),minypos=0,maxypos=0.6,
node.pos=list(),serial=FALSE,radx=0.06,rady=0.06,
xmargin=0.01,ymargin=0.01) {
#xpos=c(0,0.5);mpos=c(0.5,0.9);ypos=c(1,0.5);minypos=0;maxypos=0.6
#node.pos=list()
#serial=FALSE
# radx=0.06
# rady=0.06
# xmargin=0.01
# ymargin=0.01
X<-M<-Y<-NULL
X=labels[["X"]]
xcount=length(X)
mcount=0
if(is.null(M)) {
M=labels[["M"]]
mcount=length(M)
}
Y=labels[["Y"]]
name=c(X,M,Y)
name
if(xcount==1){
xposition = xpos[1]
yposition = xpos[2]
} else{
xposition=seq(minypos,maxypos,length.out=xcount+1)[-1]
yposition=rep(xpos[2],xcount)
}
if(xcount==1){
xposition = xpos[1]
yposition = xpos[2]
} else{
xposition=seq(minypos,maxypos,length.out=xcount+1)[-1]
yposition=rep(xpos[2],xcount)
}
if(mcount>1) {
if(mcount==2){
mympos=seq(from=0.2,to=0.8,length.out=mcount)
} else{
mympos=seq(from=0.05,to=0.95,length.out=mcount)
}
for(i in 1:mcount){
labels[[paste0("M",i)]]=labels$M[i]
}
} else {
mympos=mpos[1]
}
xposition=c(xposition,mympos)
if(mcount>2){
starty=mpos[2]-0.12
yposition=c(yposition,starty,rep(mpos[2],mcount-2),starty)
} else{
yposition=c(yposition,mpos[2])
}
xposition=c(xposition,ypos[1])
yposition=c(yposition,ypos[2])
df=data.frame(name=name,xpos=xposition,ypos=yposition)
df
df1<-df2<-NULL
if(!is.null(vars)) df1=vars2df(vars,mpos)
if(!is.null(moderator)) df2=moderator2df(moderator=moderator,mpos,vars=vars)
df=rbind(df,df1,df2)
(xlim=c(min(df$xpos)-radx-xmargin,max(df$xpos)+radx+xmargin))
(ylim=c(min(df$ypos)-rady-ymargin,max(df$ypos)+rady+ymargin))
name2pos=function(name,df,pos=0.5){
if(length(name)==1) {
pos=c(df$xpos[df$name==name],df$ypos[df$name==name])
} else if(length(name)==2){
xpos1=df$xpos[df$name==name[1]]
xpos2=df$xpos[df$name==name[2]]
ypos1=df$ypos[df$name==name[1]]
ypos2=df$ypos[df$name==name[2]]
xpos=xpos1+(xpos2-xpos1)*pos
ypos=ypos1+(ypos2-ypos1)*pos
pos=c(xpos,ypos)
} else if(length(name)==3){
xpos1=df$xpos[df$name==name[1]]
xpos2=df$xpos[df$name==name[2]]
xpos3=df$xpos[df$name==name[3]]
ypos1=df$ypos[df$name==name[1]]
ypos2=df$ypos[df$name==name[2]]
ypos3=df$ypos[df$name==name[3]]
xpos4=xpos2+(xpos3-xpos2)*pos
ypos4=ypos2+(ypos3-ypos2)*pos
xpos=xpos1+(xpos4-xpos1)*0.5
ypos=ypos1+(ypos4-ypos1)*0.5
pos=c(xpos,ypos)
}
pos
}
myarrow=function(start,end,df,arr.pos=0.5,...){
from=name2pos(start,df=df)
to=name2pos(end,df=df)
if(arr.pos==1) {
res=from-to
length=sqrt(res[1]^2+res[2]^2)
arr.pos=1-(1-length)/10
} else if(arr.pos==-1){
res=from-to
length=sqrt(res[1]^2+res[2]^2)
res=abs(res)
# cat("res=",res,"\n")
ratio=max((res[1]-radx)/res[1],(res[2]-rady)/res[2])
arr.pos=ratio-0.025
# cat("arr.pos=",arr.pos,"\n")
}
straightarrow(from,to,arr.pos=arr.pos,lwd=1,arr.length=0.3,arr.type="triangle",...)
}
openplotmat(xlim=xlim,ylim=ylim)
myarrow("X","M",df=df,-1)
myarrow("M","Y",df=df,-1)
myarrow("X","Y",df=df,-1)
if(!is.null(vars)){
for(i in 1:length(vars$name)){
for(j in 1:length(vars$site[[i]])){
vars$site[[i]][j]
if(vars$site[[i]][j]=="a") {
end=c("X","M")
} else if(vars$site[[i]][j]=="b") {
end=c("M","Y")
} else {
end=c("X","Y")
}
myarrow(vars$name[[i]][1],end,df=df,arr.pos=1)
myarrow(vars$name[[i]][2],c(vars$name[[i]][1],end),df=df,arr.pos=1)
}
}
}
if(!is.null(moderator)){
for(i in 1:length(moderator$name)){
for(j in 1:length(moderator$site[[i]])){
if(moderator$site[[i]][j]=="a") {
end=c("X","M")
} else if(moderator$site[[i]][j]=="b") {
end=c("M","Y")
} else {
end=c("X","Y")
}
myarrow(moderator$name[i],end,df=df,arr.pos=1)
}
}
}
for(i in 1:nrow(df)){
mid=c(df$xpos[i],df$ypos[i])
textrect(mid,radx,rady,lab=df$name[i])
}
}
labels=list(X="X",M="M",Y="Y")
vars=list(name=list(c("W","Z")),site=list(c("a","b")))
moderator=list(name=c("W","V"),site=list(c("c"),c("b","c")))
drawModel2(labels=labels)
drawModel2(labels=labels,vars=vars)
drawModel2(labels=labels,moderator=moderator)
drawModel2(labels=labels,vars=vars,moderator=moderator)
devtools::document()
devtools::check()
