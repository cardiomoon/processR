df=data.frame(y=y,x=x,stringsAsFactors = FALSE)
df
x=c("baby","milk","baby:milk")
labels=list(X="baby",M=c("wine","tent","sand"),Y="tile")
x=c("baby","milk","baby:milk")
labels=list(X="baby",M=c("wine","tent","sand"),Y="tile")
changeLabelName(x,labels)
labels
unlist(labels)
labels=list(X="baby",M=c("wine","tent","sand"),Y="tile")
bmatrix=c(1,1,0,1,0,0,1,1,1,1)
moderator=list(name=c("milk","hair"),labels=c("W","Z"),
matrix=list(c(1,0,0,0,0,0,0,0,0,0),c(0,0,0,0,0,0,0,1,0,0)))
drawConcept(labels=labels,parallel=TRUE,bmatrix=bmatrix,moderator=moderator)
drawModel(labels=labels,parallel=TRUE,bmatrix=bmatrix,moderator=moderator)
eq=multipleMediation(labels=labels,bmatrix=bmatrix,moderator=moderator,mode=1)
cat(eq)
drawModel(labels=labels,parallel=TRUE,bmatrix=bmatrix,moderator=moderator,
node.pos = list(W=c(0.05,0.7),`X:W`=c(0.1,0.9),Z=c(0.7,0.2),`M1:Z`=c(0.9,0.2)))
df1=labels2table(labels=labels,vars=vars,moderator=moderator,
covar=covar,serial=serial,bmatrix=bmatrix,
eq=equation)
equation=NULL
df1=labels2table(labels=labels,vars=vars,moderator=moderator,
covar=covar,serial=serial,bmatrix=bmatrix,
eq=equation)
df1$end=df1$Variables
df1$start=df1$Predictors
df1
x=c("baby","milk","baby:milk")
labels=list(X="baby",M=c("wine","tent","sand"),Y="tile",W="milk")
changeLabelName(x,labels)
eq="wine~baby+milk+baby:milk"
labels=list(X="baby",M=c("wine","tent","sand"),Y="tile")
eq2var(eq,labels=labels)
eq="wine~baby+milk+baby:milk"
labels=list(X="baby",M=c("wine","tent","sand"),Y="tile",W="milk")
eq2var(eq,labels=labels)
eq="wine~baby+milk+baby:milk"
labels=list(X="baby",M=c("wine","tent","sand"),Y="tile",W="milk")
eq2var(eq,labels=labels)
eq=str_replace_all(eq," ","")
temp=unlist(strsplit(eq,"~"))
y=temp[1]
x=unique(unlist(strsplit(temp[2],"\\+")))
y=rep(y,length(x))
df=data.frame(y=y,x=x,stringsAsFactors = FALSE)
df
df$Variables=changeLabelName(df$y,labels=labels)
df$Predictors=changeLabelName(df$x,labels=labels)
df
prefix=ifelse(df$Variables[1]=="Y","b","a")
y=temp[1]
eq="wine~baby+milk+baby:milk"
labels=list(X="baby",M=c("wine","tent","sand"),Y="tile",W="milk")
eq=str_replace_all(eq," ","")
temp=unlist(strsplit(eq,"~"))
y=temp[1]
x=unique(unlist(strsplit(temp[2],"\\+")))
y=rep(y,length(x))
df=data.frame(y=y,x=x,stringsAsFactors = FALSE)
df
df$Variables=changeLabelName(df$y,labels=labels)
df$Predictors=changeLabelName(df$x,labels=labels)
df
prefix=ifelse(df$Variables[1]=="Y","b","a")
y[1]
prefix
df$x
# labels=list(X="cond",M=c("import","pmi"),Y="reaction")
#  name=c("X","M1","M2")
#  dep="M3"
# labels=list(X="X",M=c("M1","M2","M3"),Y="Y")
# cat("name=",name,"\n")
# name=c("M","X","M:W","W","X:W")
# dep="Y"
# labels=list(X="X",M="M",Y="Y")
# constant="iy"
# prefix="b"
name=c("baby","milk","baby:milk")
prefix="a"
dep="wine"
dep="wine";constant="iy"
labels=list(X="baby",M=c("wine","tent","sand"),Y="tile",W="milk")
result=c()
dep=changeLabelName(dep,labels,add=FALSE)
dep
# cat("dep=",dep,"\n")
j<-k<-l<-m<-1
temp=changeLabelName(name,labels,add=FALSE)
cat("temp=",temp,"\n")
# labels=list(X="cond",M=c("import","pmi"),Y="reaction")
#  name=c("X","M1","M2")
#  dep="M3"
# labels=list(X="X",M=c("M1","M2","M3"),Y="Y")
# cat("name=",name,"\n")
# name=c("M","X","M:W","W","X:W")
# dep="Y"
# labels=list(X="X",M="M",Y="Y")
# constant="iy"
# prefix="b"
name=c("baby","milk","baby:milk")
prefix="a"
dep="wine";constant="iy"
labels=list(X="baby",M=c("wine","tent","sand"),Y="tile",W="milk")
result=c()
dep=changeLabelName(dep,labels,add=FALSE)
dep
# cat("dep=",dep,"\n")
j<-k<-l<-m<-1
temp=changeLabelName(name,labels,add=FALSE)
for(i in seq_along(temp)){
if(dep=="Y"){
if(temp[i]=="(Intercept)"){
result=c(result,"iY")
} else if(str_detect(temp[i],"^X[1-9]?")){
result=c(result,paste0("c",j))
j=j+1
} else if(str_detect(temp[i],"^C[1-9]?")){
if(nchar(temp[i])==1){
result=c(result,paste0("g"))
} else{
result=c(result,paste0("g",substr(temp[i],2,2)))
}
} else if(str_detect(temp[i],"^(W|V|Z)[1-9]?")){
if(paste0("X:",temp[i]) %in% temp){
result=c(result,paste0("c",j))
j=j+1
} else{
result=c(result,paste0("b",l))
l=l+1
}
} else if(str_detect(temp[i],":X[1-9]?")){
result=c(result,paste0("c",j))
j=j+1
} else{
result=c(result,paste0("b",l))
l=l+1
}
} else if(dep=="M"){
if(temp[i]=="(Intercept)"){
result=c(result,"iM")
} else if(str_detect(temp[i],"^C[1-9]?")){
if(nchar(temp[i])==1){
result=c(result,"f")
} else{
result=c(result,paste0("f",substr(temp[i],2,2)))
}
} else{
result=c(result,paste0("a",j))
j=j+1
}
} else{    ##  "M1","M2",...
if(temp[i]=="(Intercept)"){
result=c(result,paste0("i",dep))
} else if(str_detect(temp[i],"^C[1-9]?")){
result=c(result,paste0("f",k))
k=k+1
} else if(str_detect(temp[i],"^M[1:9]?")){
if(nchar(temp[i])==2){  # M1
result=c(result,paste0("d",substr(dep,2,2),substr(temp[i],2,2)))
} else{  ## M1:W
result=c(result,paste0("d",substr(dep,2,2),substr(temp[i],2,2),l))
l<-l+1
}
} else if(str_detect(temp[i],"^(W|V|Z)[1-9]?")){
if(paste0("X:",temp[i]) %in% temp){
result=c(result,paste0("a",j,substr(dep,2,2)))
j=j+1
} else{
tempvar=temp[str_detect(temp,"^M[1-9]:")][1]
result=c(result,paste0("d",substr(dep,2,2),substr(tempvar,2,2),l))
# result=c(result,paste0(prefix,l))
l<-l+1
# result=c(result,paste0("b",l))
# l=l+1
}
} else{
if(length(temp[i])==1){
result=c(result,paste0("a",substr(dep,2,2)))
} else{
result=c(result,paste0("a",j,substr(dep,2,2)))
j=j+1
}
}
}
# if(temp[i]=="(Intercept)") {
#    if(dep=="M1") {
#      result=c(result,"iM1")
#    } else if(dep=="M2"){
#      result=c(result,"iM2")
#    } else {
#      result=c(result,constant)
#    }
# } else if(temp[i]=="M") {
#   result=c(result,paste0("b",l))
#   l=l+1
# } else if(substr(temp[i],1,1)=="C"){
#   if(dep=="Y") {
#     result=c(result,paste0("g",k))
#   } else{
#     result=c(result,paste0("f",k))
#
#   }
#   k<-k+1
# } else if(temp[i]=="X"){
#   if(dep=="Y") {
#      result=c(result,paste0(ifelse(any(str_detect(temp,"^M")),"c'","c"),j))
#
#   } else if(str_detect(dep,"^M")){
#      result=c(result,paste0("a",j))
#   }  else{
#     result=c(result,paste0(prefix,j))
#
#   }
#   j<-j+1
# } else if(temp[i]=="W"){
#   if(("X:W" %in% temp)|("W:X" %in% temp)|("D1:W" %in% temp)|("W:D1" %in% temp)){
#     if(dep=="Y") {
#       result=c(result,paste0(ifelse(any(str_detect(temp,"^M")),"c'","c"),j))
#
#     } else{
#       result=c(result,paste0(prefix,j))
#
#     }
#     j<-j+1
#   } else if(dep %in% c(paste0("M",2:9))) {
#     tempvar=temp[str_detect(temp,"^M[1-9]:")][1]
#     temp1=paste0("d",substr(dep,2,2),substr(tempvar,2,2))
#     if(m>1) temp1=paste0(temp1,m)
#     result=c(result,temp1)
#     m<-m+1
#   } else{
#     # result=c(result,paste0("b",l))
#     # l<-l+1
#     if(any(str_detect(temp,"^M[1-9]:"))){
#       # tempvar=temp[str_detect(temp,"^M[1-9]:")][1]
#       # cat("tempvar=",tempvar,"\n")
#       # result=c(result,paste0(prefix,substr(tempvar,2,2),l))
#       result=c(result,paste0(prefix,l))
#       l<-l+1
#     } else{
#       result=c(result,paste0(prefix,j))
#       l<-l+1
#     }
#
#   }
#
# } else if(temp[i] %in% c("X:W","W:X")){
#   if(dep=="Y") {
#     result=c(result,paste0(ifelse(any(str_detect(temp,"^M")),"c'","c"),j))
#
#   } else{
#     result=c(result,paste0(prefix,j))
#
#   }
#   j<-j+1
#
#
# } else if(str_detect(temp[i],"^D[0-9]")){
#   if(dep=="Y") {
#     result=c(result,paste0(ifelse("M" %in% temp,"c'","c"),j))
#
#   } else{
#     result=c(result,paste0(prefix,j))
#
#   }
#   j<-j+1
#
#
# } else if(str_detect(temp[i],"^M[1-9]:?")){
#
#   if(dep %in% c(paste0("M",2:9))) {
#      temp1=paste0("d",substr(dep,2,2),substr(temp[i],2,2))
#      if(m>1) temp1=paste0(temp1,m)
#      result=c(result,temp1)
#      m<-m+1
#   } else{
#     # result=c(result,paste0("b",substr(temp[i],2,2),l))
#     result=c(result,paste0("b",l))
#     l=l+1
#   }
# } else {  #if(temp[i]=="M:W")
#    result=c(result,paste0("b",l))
#    l=l+1
#
# }
}
result
temp
library(processR)
# labels=list(X="cond",M=c("import","pmi"),Y="reaction")
#  name=c("X","M1","M2")
#  dep="M3"
# labels=list(X="X",M=c("M1","M2","M3"),Y="Y")
# cat("name=",name,"\n")
# name=c("M","X","M:W","W","X:W")
# dep="Y"
# labels=list(X="X",M="M",Y="Y")
# constant="iy"
# prefix="b"
name=c("baby","milk","baby:milk")
prefix="a"
dep="wine";constant="iy"
labels=list(X="baby",M=c("wine","tent","sand"),Y="tile",W="milk")
result=c()
dep=changeLabelName(dep,labels,add=FALSE)
dep
# cat("dep=",dep,"\n")
j<-k<-l<-m<-1
temp=changeLabelName(name,labels,add=FALSE)
for(i in seq_along(temp)){
if(dep=="Y"){
if(temp[i]=="(Intercept)"){
result=c(result,"iY")
} else if(str_detect(temp[i],"^X[1-9]?")){
result=c(result,paste0("c",j))
j=j+1
} else if(str_detect(temp[i],"^C[1-9]?")){
if(nchar(temp[i])==1){
result=c(result,paste0("g"))
} else{
result=c(result,paste0("g",substr(temp[i],2,2)))
}
} else if(str_detect(temp[i],"^(W|V|Z)[1-9]?")){
if(paste0("X:",temp[i]) %in% temp){
result=c(result,paste0("c",j))
j=j+1
} else{
result=c(result,paste0("b",l))
l=l+1
}
} else if(str_detect(temp[i],":X[1-9]?")){
result=c(result,paste0("c",j))
j=j+1
} else{
result=c(result,paste0("b",l))
l=l+1
}
} else if(dep=="M"){
if(temp[i]=="(Intercept)"){
result=c(result,"iM")
} else if(str_detect(temp[i],"^C[1-9]?")){
if(nchar(temp[i])==1){
result=c(result,"f")
} else{
result=c(result,paste0("f",substr(temp[i],2,2)))
}
} else{
result=c(result,paste0("a",j))
j=j+1
}
} else{    ##  "M1","M2",...
if(temp[i]=="(Intercept)"){
result=c(result,paste0("i",dep))
} else if(str_detect(temp[i],"^C[1-9]?")){
result=c(result,paste0("f",k))
k=k+1
} else if(str_detect(temp[i],"^M[1:9]?")){
if(nchar(temp[i])==2){  # M1
result=c(result,paste0("d",substr(dep,2,2),substr(temp[i],2,2)))
} else{  ## M1:W
result=c(result,paste0("d",substr(dep,2,2),substr(temp[i],2,2),l))
l<-l+1
}
} else if(str_detect(temp[i],"^(W|V|Z)[1-9]?")){
if(paste0("X:",temp[i]) %in% temp){
result=c(result,paste0("a",j,substr(dep,2,2)))
j=j+1
} else{
tempvar=temp[str_detect(temp,"^M[1-9]:")][1]
result=c(result,paste0("d",substr(dep,2,2),substr(tempvar,2,2),l))
# result=c(result,paste0(prefix,l))
l<-l+1
# result=c(result,paste0("b",l))
# l=l+1
}
} else{
if(length(temp)==1){
result=c(result,paste0("a",substr(dep,2,2)))
} else{
result=c(result,paste0("a",j,substr(dep,2,2)))
j=j+1
}
}
}
# if(temp[i]=="(Intercept)") {
#    if(dep=="M1") {
#      result=c(result,"iM1")
#    } else if(dep=="M2"){
#      result=c(result,"iM2")
#    } else {
#      result=c(result,constant)
#    }
# } else if(temp[i]=="M") {
#   result=c(result,paste0("b",l))
#   l=l+1
# } else if(substr(temp[i],1,1)=="C"){
#   if(dep=="Y") {
#     result=c(result,paste0("g",k))
#   } else{
#     result=c(result,paste0("f",k))
#
#   }
#   k<-k+1
# } else if(temp[i]=="X"){
#   if(dep=="Y") {
#      result=c(result,paste0(ifelse(any(str_detect(temp,"^M")),"c'","c"),j))
#
#   } else if(str_detect(dep,"^M")){
#      result=c(result,paste0("a",j))
#   }  else{
#     result=c(result,paste0(prefix,j))
#
#   }
#   j<-j+1
# } else if(temp[i]=="W"){
#   if(("X:W" %in% temp)|("W:X" %in% temp)|("D1:W" %in% temp)|("W:D1" %in% temp)){
#     if(dep=="Y") {
#       result=c(result,paste0(ifelse(any(str_detect(temp,"^M")),"c'","c"),j))
#
#     } else{
#       result=c(result,paste0(prefix,j))
#
#     }
#     j<-j+1
#   } else if(dep %in% c(paste0("M",2:9))) {
#     tempvar=temp[str_detect(temp,"^M[1-9]:")][1]
#     temp1=paste0("d",substr(dep,2,2),substr(tempvar,2,2))
#     if(m>1) temp1=paste0(temp1,m)
#     result=c(result,temp1)
#     m<-m+1
#   } else{
#     # result=c(result,paste0("b",l))
#     # l<-l+1
#     if(any(str_detect(temp,"^M[1-9]:"))){
#       # tempvar=temp[str_detect(temp,"^M[1-9]:")][1]
#       # cat("tempvar=",tempvar,"\n")
#       # result=c(result,paste0(prefix,substr(tempvar,2,2),l))
#       result=c(result,paste0(prefix,l))
#       l<-l+1
#     } else{
#       result=c(result,paste0(prefix,j))
#       l<-l+1
#     }
#
#   }
#
# } else if(temp[i] %in% c("X:W","W:X")){
#   if(dep=="Y") {
#     result=c(result,paste0(ifelse(any(str_detect(temp,"^M")),"c'","c"),j))
#
#   } else{
#     result=c(result,paste0(prefix,j))
#
#   }
#   j<-j+1
#
#
# } else if(str_detect(temp[i],"^D[0-9]")){
#   if(dep=="Y") {
#     result=c(result,paste0(ifelse("M" %in% temp,"c'","c"),j))
#
#   } else{
#     result=c(result,paste0(prefix,j))
#
#   }
#   j<-j+1
#
#
# } else if(str_detect(temp[i],"^M[1-9]:?")){
#
#   if(dep %in% c(paste0("M",2:9))) {
#      temp1=paste0("d",substr(dep,2,2),substr(temp[i],2,2))
#      if(m>1) temp1=paste0(temp1,m)
#      result=c(result,temp1)
#      m<-m+1
#   } else{
#     # result=c(result,paste0("b",substr(temp[i],2,2),l))
#     result=c(result,paste0("b",l))
#     l=l+1
#   }
# } else {  #if(temp[i]=="M:W")
#    result=c(result,paste0("b",l))
#    l=l+1
#
# }
}
result
if(!("c2" %in% result)) result[result=="c1"]="c"
if(!("c'2" %in% result)) result[result=="c'1"]="c'"
if(!("b2" %in% result)) result[result=="b1"]="b"
if(!dep %in% c("M1","M2","M3")){
if(!("a2" %in% result)) result[result=="a1"]="a"
}
if(!("f2" %in% result)) result[result=="f1"]="f"
if(!("g2" %in% result)) result[result=="g1"]="g"
if("W:X" %in% temp) {
result[result=="c'1"]="c'4"
result[result=="c'2"]="c'1"
result[result=="c'4"]="c'2"
}
# cat("result=",result,"\n")
result
library(processR)
# Three mediator with two moderator
labels=list(X="baby",M=c("wine","tent","sand"),Y="tile")
bmatrix=c(1,1,0,1,0,0,1,1,1,1)
moderator=list(name=c("milk","hair"),labels=c("W","Z"),
matrix=list(c(1,0,0,0,0,0,0,0,0,0),c(0,0,0,0,0,0,0,1,0,0)))
drawConcept(labels=labels,parallel=TRUE,bmatrix=bmatrix,moderator=moderator)
drawModel(labels=labels,parallel=TRUE,bmatrix=bmatrix,moderator=moderator)
