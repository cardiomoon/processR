cat(tripleEquation(X=X,M=M,Y=Y))
labels=list(X="hp",M="am",Y="mpg",W="wt",Z="cyl")
moderator=list(name=c("wt","cyl"),site=list(c("a"),c("b")))
model=tripleEquation(labels=labels,moderator=moderator)
cat(model)
X="negemot";Y="govact";suffix=0
vars=list(name=list(c("sex","age")),site=list(c("c")))
cat(tripleEquation(X=X,Y=Y,vars=vars))
labels=list(X="hp",M="am",Y="mpg",W="wt",Z="cyl")
moderator=list(name=c("wt","cyl"),site=list(c("a"),c("b")))
model=tripleEquation(labels=labels,moderator=moderator)
cat(model)
model=tripleEquation(labels=labels,moderator=moderator)
labels=list(X="frame",M="justify",Y="donate",W="skeptic")
moderator=list(name=c("skeptic","Z"),site=list(c("a","b","c"),c("b")))
X=NULL;M=NULL;Y=NULL;vars=NULL;suffix=0;
covar=NULL;range=TRUE;mode=0;data=NULL;rangemode=1;probs=c(0.16,0.5,0.84)
if(is.null(X)) X=labels$X
if(is.null(M)) if(!is.null(labels$M)) M=labels$M
if(is.null(Y)) Y=labels$Y
temp1<-temp2<-temp3<-temp4<-NULL
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
res=seekNameVars(vars,"a")
if(length(res)>0) {
for(i in 1:length(res)){
newvars=c(X,vars$name[[res[i]]])
temp1=c(temp1,tripleInteraction(newvars,prefix="a",suffix=suffix,mode=mode,addPrefix=FALSE))
suffix=suffix+1
}
}
temp1
if(!is.null(M)){
XM=c(X,XM)
XMstr=interactStr(XM,addPrefix=FALSE)
temp1=union(temp1,XMstr)
if(mode==0) temp1=paste0("a",1:length(temp1),"*",temp1)
temp4=paste0(M,"~",paste(temp1,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"Mi|M",M))
if(mode){
temp4=addCovarEquation(temp4,covar,prefix=NULL)
} else{
temp4=addCovarEquation(temp4,covar,prefix="f")
}
}
}
res=seekNameVars(vars,"b")
length(res)
if(length(res)>0) {
for(i in 1:length(res)){
newvars=c(M,vars$name[[res[i]]])
temp2=c(temp2,tripleInteraction(newvars,prefix="b",suffix=suffix,mode=mode,addPrefix=FALSE))
suffix=suffix+1
}
}
temp2
MY=c(M,MY)
MYstr=interactStr(MY,addPrefix=FALSE)
MYstr
for(i in 1:length(moderator$site)){
if("c" %in% moderator$site[[i]]) MYstr=setdiff(MYstr,moderator$name[i])
}
temp2=union(temp2,MYstr)
temp2
if(mode==0) {
if(length(temp2)>0) temp2=paste0("b",1:length(temp2),"*",temp2)
}
res=seekNameVars(vars,"c")
if(length(res)>0) {
for(i in 1:length(res)){
newvars=c(X,vars$name[[res[i]]])
if("a" %in% vars$site[[res[i]]]){
newsuffix=0
if(res[i]>1){
for(j in 1:res[i]){
if("a" %in% vars$site[[j]]) newsuffix=newsuffix+1
}
}
} else{
newsuffix=suffix
}
temp3=c(temp3,tripleInteraction(newvars,suffix=newsuffix,mode=mode,addPrefix=FALSE))
suffix=suffix+1
}
}
XY=c(X,XY)
XYstr=interactStr(XY,addPrefix=FALSE)
temp3=union(temp3,XYstr)
if(mode==0) temp3=paste0("c",1:length(temp3),"*",temp3)
temp3
temp=c(temp3,temp2)
temp=paste0(Y,"~",paste(temp,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"Y",Y))
if(mode){
temp=addCovarEquation(temp,covar,prefix=NULL)
} else{
temp=addCovarEquation(temp,covar,prefix="g")
}
}
temp=c(temp4,temp)
equation=paste(temp,collapse="\n")
equation=paste0(equation,"\n")
if(mode==0){
moderatorNames=union(unlist(vars$name),moderator$name)
for(i in seq_along(moderatorNames)){
name=moderatorNames[i]
temp=paste0(name," ~ ",name,".mean*1\n")
temp=paste0(temp,name," ~~ ",name,".var*",name,"\n")
equation=paste0(equation,temp)
}
temp=makeIndirectEquation(X,M,temp1,temp2,temp3,moderatorNames,range=range,data=data,rangemode=rangemode)
equation=paste0(equation,temp)
}
if(mode==0) equation=deleteSingleNumber(equation)
equation
equation
equation[1]
equation[2]
equation[1]==equation[2]
cat(equation)
str(equation)
cat(equation[1])
cat(equation[2])
labels=list(X="frame",M="justify",Y="donate",W="skeptic")
moderator=list(name=c("skeptic","Z"),site=list(c("a","b","c"),c("b")))
X=NULL;M=NULL;Y=NULL;vars=NULL;suffix=0;
covar=NULL;range=TRUE;mode=0;data=NULL;rangemode=1;probs=c(0.16,0.5,0.84)
if(is.null(X)) X=labels$X
if(is.null(M)) if(!is.null(labels$M)) M=labels$M
if(is.null(Y)) Y=labels$Y
temp1<-temp2<-temp3<-temp4<-NULL
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
res=seekNameVars(vars,"a")
if(length(res)>0) {
for(i in 1:length(res)){
newvars=c(X,vars$name[[res[i]]])
temp1=c(temp1,tripleInteraction(newvars,prefix="a",suffix=suffix,mode=mode,addPrefix=FALSE))
suffix=suffix+1
}
}
temp1
if(!is.null(M)){
XM=c(X,XM)
XMstr=interactStr(XM,addPrefix=FALSE)
temp1=union(temp1,XMstr)
if(mode==0) temp1=paste0("a",1:length(temp1),"*",temp1)
temp4=paste0(M,"~",paste(temp1,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"Mi|M",M))
if(mode){
temp4=addCovarEquation(temp4,covar,prefix=NULL)
} else{
temp4=addCovarEquation(temp4,covar,prefix="f")
}
}
}
res=seekNameVars(vars,"b")
length(res)
if(length(res)>0) {
for(i in 1:length(res)){
newvars=c(M,vars$name[[res[i]]])
temp2=c(temp2,tripleInteraction(newvars,prefix="b",suffix=suffix,mode=mode,addPrefix=FALSE))
suffix=suffix+1
}
}
temp2
MY=c(M,MY)
MYstr=interactStr(MY,addPrefix=FALSE)
MYstr
for(i in 1:length(moderator$site)){
if("c" %in% moderator$site[[i]]) MYstr=setdiff(MYstr,moderator$name[i])
}
temp2=union(temp2,MYstr)
temp2
if(mode==0) {
if(length(temp2)>0) temp2=paste0("b",1:length(temp2),"*",temp2)
}
res=seekNameVars(vars,"c")
if(length(res)>0) {
for(i in 1:length(res)){
newvars=c(X,vars$name[[res[i]]])
if("a" %in% vars$site[[res[i]]]){
newsuffix=0
if(res[i]>1){
for(j in 1:res[i]){
if("a" %in% vars$site[[j]]) newsuffix=newsuffix+1
}
}
} else{
newsuffix=suffix
}
temp3=c(temp3,tripleInteraction(newvars,suffix=newsuffix,mode=mode,addPrefix=FALSE))
suffix=suffix+1
}
}
XY=c(X,XY)
XYstr=interactStr(XY,addPrefix=FALSE)
temp3=union(temp3,XYstr)
if(mode==0) temp3=paste0("c",1:length(temp3),"*",temp3)
temp3
temp=c(temp3,temp2)
temp=paste0(Y,"~",paste(temp,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"Y",Y))
if(mode){
temp=addCovarEquation(temp,covar,prefix=NULL)
} else{
temp=addCovarEquation(temp,covar,prefix="g")
}
}
temp=c(temp4,temp)
equation=paste(temp,collapse="\n")
equation=paste0(equation,"\n")
if(mode==0){
moderatorNames=union(unlist(vars$name),moderator$name)
for(i in seq_along(moderatorNames)){
name=moderatorNames[i]
temp=paste0(name," ~ ",name,".mean*1\n")
temp=paste0(temp,name," ~~ ",name,".var*",name,"\n")
equation=paste0(equation,temp)
}
temp=makeIndirectEquation(X,M,temp1,temp2,temp3,moderatorNames,range=range,data=data,rangemode=rangemode)
equation=paste0(equation,temp)
}
if(mode==0) equation=deleteSingleNumber(equation)
equation
labels=list(X="frame",M="justify",Y="donate",W="skeptic")
moderator=list(name=c("skeptic","Z"),site=list(c("a","b","c"),c("b")))
X=NULL;M=NULL;Y=NULL;vars=NULL;suffix=0;
covar=NULL;range=TRUE;mode=0;data=NULL;rangemode=1;probs=c(0.16,0.5,0.84)
if(is.null(X)) X=labels$X
if(is.null(M)) if(!is.null(labels$M)) M=labels$M
if(is.null(Y)) Y=labels$Y
temp1<-temp2<-temp3<-temp4<-NULL
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
res=seekNameVars(vars,"a")
if(length(res)>0) {
for(i in 1:length(res)){
newvars=c(X,vars$name[[res[i]]])
temp1=c(temp1,tripleInteraction(newvars,prefix="a",suffix=suffix,mode=mode,addPrefix=FALSE))
suffix=suffix+1
}
}
temp1
if(!is.null(M)){
XM=c(X,XM)
XMstr=interactStr(XM,addPrefix=FALSE)
temp1=union(temp1,XMstr)
if(mode==0) temp1=paste0("a",1:length(temp1),"*",temp1)
temp4=paste0(M,"~",paste(temp1,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"Mi|M",M))
if(mode){
temp4=addCovarEquation(temp4,covar,prefix=NULL)
} else{
temp4=addCovarEquation(temp4,covar,prefix="f")
}
}
}
res=seekNameVars(vars,"b")
length(res)
if(length(res)>0) {
for(i in 1:length(res)){
newvars=c(M,vars$name[[res[i]]])
temp2=c(temp2,tripleInteraction(newvars,prefix="b",suffix=suffix,mode=mode,addPrefix=FALSE))
suffix=suffix+1
}
}
temp2
MY=c(M,MY)
MYstr=interactStr(MY,addPrefix=FALSE)
MYstr
for(i in 1:length(moderator$site)){
if("c" %in% moderator$site[[i]]) MYstr=setdiff(MYstr,moderator$name[i])
}
temp2=union(temp2,MYstr)
temp2
if(mode==0) {
if(length(temp2)>0) temp2=paste0("b",1:length(temp2),"*",temp2)
}
res=seekNameVars(vars,"c")
if(length(res)>0) {
for(i in 1:length(res)){
newvars=c(X,vars$name[[res[i]]])
if("a" %in% vars$site[[res[i]]]){
newsuffix=0
if(res[i]>1){
for(j in 1:res[i]){
if("a" %in% vars$site[[j]]) newsuffix=newsuffix+1
}
}
} else{
newsuffix=suffix
}
temp3=c(temp3,tripleInteraction(newvars,suffix=newsuffix,mode=mode,addPrefix=FALSE))
suffix=suffix+1
}
}
XY=c(X,XY)
XYstr=interactStr(XY,addPrefix=FALSE)
temp3=union(temp3,XYstr)
if(mode==0) temp3=paste0("c",1:length(temp3),"*",temp3)
temp3
temp=c(temp3,temp2)
temp=paste0(Y,"~",paste(temp,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"Y",Y))
if(mode){
temp=addCovarEquation(temp,covar,prefix=NULL)
} else{
temp=addCovarEquation(temp,covar,prefix="g")
}
}
temp=c(temp4,temp)
temp
equation=paste(temp,collapse="\n")
equation=paste0(equation,"\n")
if(mode==0){
moderatorNames=union(unlist(vars$name),moderator$name)
for(i in seq_along(moderatorNames)){
name=moderatorNames[i]
temp=paste0(name," ~ ",name,".mean*1\n")
temp=paste0(temp,name," ~~ ",name,".var*",name,"\n")
equation=paste0(equation,temp)
}
temp=makeIndirectEquation(X,M,temp1,temp2,temp3,moderatorNames,range=range,data=data,rangemode=rangemode)
equation=paste0(equation,temp)
}
equation
labels=list(X="frame",M="justify",Y="donate",W="skeptic")
moderator=list(name=c("skeptic","Z"),site=list(c("a","b","c"),c("b")))
X=NULL;M=NULL;Y=NULL;vars=NULL;suffix=0;
covar=NULL;range=TRUE;mode=0;data=NULL;rangemode=1;probs=c(0.16,0.5,0.84)
if(is.null(X)) X=labels$X
if(is.null(M)) if(!is.null(labels$M)) M=labels$M
if(is.null(Y)) Y=labels$Y
temp1<-temp2<-temp3<-temp4<-NULL
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
res=seekNameVars(vars,"a")
if(length(res)>0) {
for(i in 1:length(res)){
newvars=c(X,vars$name[[res[i]]])
temp1=c(temp1,tripleInteraction(newvars,prefix="a",suffix=suffix,mode=mode,addPrefix=FALSE))
suffix=suffix+1
}
}
temp1
if(!is.null(M)){
XM=c(X,XM)
XMstr=interactStr(XM,addPrefix=FALSE)
temp1=union(temp1,XMstr)
if(mode==0) temp1=paste0("a",1:length(temp1),"*",temp1)
temp4=paste0(M,"~",paste(temp1,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"Mi|M",M))
if(mode){
temp4=addCovarEquation(temp4,covar,prefix=NULL)
} else{
temp4=addCovarEquation(temp4,covar,prefix="f")
}
}
}
res=seekNameVars(vars,"b")
length(res)
if(length(res)>0) {
for(i in 1:length(res)){
newvars=c(M,vars$name[[res[i]]])
temp2=c(temp2,tripleInteraction(newvars,prefix="b",suffix=suffix,mode=mode,addPrefix=FALSE))
suffix=suffix+1
}
}
temp2
MY=c(M,MY)
MYstr=interactStr(MY,addPrefix=FALSE)
MYstr
for(i in 1:length(moderator$site)){
if("c" %in% moderator$site[[i]]) MYstr=setdiff(MYstr,moderator$name[i])
}
temp2=union(temp2,MYstr)
temp2
if(mode==0) {
if(length(temp2)>0) temp2=paste0("b",1:length(temp2),"*",temp2)
}
res=seekNameVars(vars,"c")
if(length(res)>0) {
for(i in 1:length(res)){
newvars=c(X,vars$name[[res[i]]])
if("a" %in% vars$site[[res[i]]]){
newsuffix=0
if(res[i]>1){
for(j in 1:res[i]){
if("a" %in% vars$site[[j]]) newsuffix=newsuffix+1
}
}
} else{
newsuffix=suffix
}
temp3=c(temp3,tripleInteraction(newvars,suffix=newsuffix,mode=mode,addPrefix=FALSE))
suffix=suffix+1
}
}
XY=c(X,XY)
XYstr=interactStr(XY,addPrefix=FALSE)
temp3=union(temp3,XYstr)
if(mode==0) temp3=paste0("c",1:length(temp3),"*",temp3)
temp3
temp=c(temp3,temp2)
temp=paste0(Y,"~",paste(temp,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"Y",Y))
if(mode){
temp=addCovarEquation(temp,covar,prefix=NULL)
} else{
temp=addCovarEquation(temp,covar,prefix="g")
}
}
temp=c(temp4,temp)
equation=paste(temp,collapse="\n")
equation=paste0(equation,"\n")
equation
moderatorNames=union(unlist(vars$name),moderator$name)
for(i in seq_along(moderatorNames)){
name=moderatorNames[i]
temp=paste0(name," ~ ",name,".mean*1\n")
temp=paste0(temp,name," ~~ ",name,".var*",name,"\n")
equation=paste0(equation,temp)
}
equation
temp=makeIndirectEquation(X,M,temp1,temp2,temp3,moderatorNames,range=range,data=data,rangemode=rangemode)
temp
moderatorNames
temp
temp[1]
cat(temp[1])
cat(temp[2])
temp[1]==temp[2]
string="(a1+a3*skeptic.mean)*(b1+b2*skeptic.mean+b4*Z.mean)"
extractIMM(string)
mod=extractModerator(string)
if(is.null(mod)) return(NULL)
string=str_replace_all(string,mod,"W")
string
temp=unlist(strsplit(string,"\\)\\*\\("))
temp[1]=str_replace(temp[1],"\\(","")
temp[2]=str_replace(temp[2],"\\)","")
templist=strsplit(temp,"\\+")
result=c()
for(i in seq_along(templist[[1]])){
for(j in seq_along(templist[[2]])){
result=c(result,paste0(templist[[1]][i],"*",templist[[2]][j]))
}
}
result=result[str_detect(result,"W")]
result=str_replace(result,"\\*W","")
result=paste0(result,collapse="+")
result
str_replace(result,"W",mod[1])
devtools::document()
devtools::check()
labels=list(X="hp",M="am",Y="mpg",W="wt",Z="cyl")
moderator=list(name=c("wt","cyl"),site=list(c("a"),c("b")))
model=tripleEquation(labels=labels,moderator=moderator)
cat(model)
semfit=sem(model=model,data=disaster,se="boot",bootstrap=200)
library(lavaan)
labels=list(X="hp",M="am",Y="mpg",W="wt",Z="cyl")
moderator=list(name=c("wt","cyl"),site=list(c("a"),c("b")))
model=tripleEquation(labels=labels,moderator=moderator)
cat(model)
semfit=sem(model=model,data=disaster,se="boot",bootstrap=200)
library(lavaan)
labels=list(X="hp",M="am",Y="mpg",W="wt",Z="cyl")
moderator=list(name=c("wt","cyl"),site=list(c("a"),c("b")))
model=tripleEquation(labels=labels,moderator=moderator)
cat(model)
semfit=sem(model=model,data=disaster,se="boot",bootstrap=200)
semfit=sem(model=model,data=disaster)
library(processR)
library(lavaan)
labels=list(X="hp",M="am",Y="mpg",W="wt",Z="cyl")
moderator=list(name=c("wt","cyl"),site=list(c("a"),c("b")))
model=tripleEquation(labels=labels,moderator=moderator)
cat(model)
semfit=sem(model=model,data=disaster)
semfit=sem(model=model,data=mtcars)
semfit=sem(model=model,data=mtcars,se="boot",bootstrap=200)
summary(semfit,ci=TRUE)
estimatesTable(semfit)
medSummary(semfit)
medSummaryTable(semfit)
devtools::document()
devtools::check()
library(processR)
string="(a1+a3*age.mean)*(b1+b3*age.mean)"
extractIMM(string)
string="(a1+a3*skeptic.mean)*(b1+b2*skeptic.mean+b4*Z.mean)"
extractIMM(string)
string="(a1+a3*age.mean)*(b)"
extractIMM(string)
string="(a1+a3*4.12)*(b)"
extractIMM(string)
string="(a)*(b)"
extractIMM(string)
