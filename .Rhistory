vars=c(vars,res)
if(mode==0){
temp1=c()
for(k in 1:length(res)){
temp1=c(temp1,paste0(prefix,k,ifelse(xcount>1,i,""),
ifelse(ycount>1,j,""),"*",res[k]))
}
} else{
temp1=res
}
res1=c(res1,temp1)
if(serial) {
if(j>1) {
for(k in 1:(j-1)){
if(mode==0) {
res1=c(res1,paste0("d",j,k,"*",Y[k]))
} else{
res1=c(res1,Y[k])
}
}
}
}
}
res1
temp=c(temp,paste0(Y[j],"~",paste0(res1,collapse="+")))
}
temp
j=1
res1=c()
for(i in 1:xcount){
res=c()
res=c(res,X[i])
res
for(l in seq_along(W)){
if(length(pos)==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(length(pos[[l]])==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(i %in% pos[[l]]){
res=c(res,W[l],paste0(X[i],":",W[l]))
}
}
res
res=setdiff(res,vars)
vars=c(vars,res)
if(mode==0){
temp1=c()
for(k in 1:length(res)){
temp1=c(temp1,paste0(prefix,k,ifelse(xcount>1,i,""),
ifelse(ycount>1,j,""),"*",res[k]))
}
} else{
temp1=res
}
res1=c(res1,temp1)
if(serial) {
if(j>1) {
for(k in 1:(j-1)){
if(mode==0) {
res1=c(res1,paste0("d",j,k,"*",Y[k]))
} else{
res1=c(res1,Y[k])
}
}
}
}
}
res1
j=1
temp=c()
vars=c()
j=1
for(j in 1:ycount){
res1=c()
for(i in 1:xcount){
res=c()
res=c(res,X[i])
res
for(l in seq_along(W)){
if(length(pos)==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(length(pos[[l]])==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(i %in% pos[[l]]){
res=c(res,W[l],paste0(X[i],":",W[l]))
}
}
res
res=setdiff(res,vars)
vars=c(vars,res)
if(mode==0){
temp1=c()
for(k in 1:length(res)){
temp1=c(temp1,paste0(prefix,k,ifelse(xcount>1,i,""),
ifelse(ycount>1,j,""),"*",res[k]))
}
} else{
temp1=res
}
res1=c(res1,temp1)
if(serial) {
if(j>1) {
for(k in 1:(j-1)){
if(mode==0) {
res1=c(res1,paste0("d",j,k,"*",Y[k]))
} else{
res1=c(res1,Y[k])
}
}
}
}
}
res1
temp=c(temp,paste0(Y[j],"~",paste0(res1,collapse="+")))
}
temp
j=1
res1=c()
j=1;i=1
res=c()
res=c(res,X[i])
res
for(l in seq_along(W)){
if(length(pos)==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(length(pos[[l]])==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(i %in% pos[[l]]){
res=c(res,W[l],paste0(X[i],":",W[l]))
}
}
res
X="wt";Y=c("cyl","am");W=NULL;labels=list();prefix="a";mode=0;pos=list();serial=TRUE
if(is.null(X)) X=labels$X
if(is.null(W)) if(!is.null(labels$W)) W=labels$W
if(is.null(Y)) Y=labels$Y
xgroup<-wgroup<-c()
xcount<-wcount<-ycount<-0
xcount=length(X)
wcount=length(W)
ycount=length(Y)
temp=c()
for(j in 1:ycount){
res1=c()
vars=c()
for(i in 1:xcount){
res=c()
res=c(res,X[i])
res
for(l in seq_along(W)){
if(length(pos)==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(length(pos[[l]])==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(i %in% pos[[l]]){
res=c(res,W[l],paste0(X[i],":",W[l]))
}
}
res
res=setdiff(res,vars)
vars=c(vars,res)
if(mode==0){
temp1=c()
for(k in 1:length(res)){
temp1=c(temp1,paste0(prefix,k,ifelse(xcount>1,i,""),
ifelse(ycount>1,j,""),"*",res[k]))
}
} else{
temp1=res
}
res1=c(res1,temp1)
if(serial) {
if(j>1) {
for(k in 1:(j-1)){
if(mode==0) {
res1=c(res1,paste0("d",j,k,"*",Y[k]))
} else{
res1=c(res1,Y[k])
}
}
}
}
}
res1
temp=c(temp,paste0(Y[j],"~",paste0(res1,collapse="+")))
}
temp
eq=paste0(temp,collapse="\n")
eq
library(processR)
labels=list(X="wt",M=c("cyl","am"),Y="mpg")
moderator=list(name=c("vs"),site=list(c("b1","b2")))
eq=multipleMediation(labels=labels,moderator=moderator,data=mtcars,range=FALSE,serial=TRUE,mode=1)
cat(eq)
drawModel(equation=eq)
drawModel(equation=eq,labels=labels)
labels=list(X="wt",M=c("cyl","am"),Y="mpg")
moderator=list(name=c("vs"),site=list(c("b1","b2")))
eq=multipleMediation(labels=labels,moderator=moderator,data=mtcars,range=FALSE,serial=FALSE,mode=1)
drawModel(equation=eq,labels=labels)
library(processR)
labels=list(X="wt",M=c("cyl","am"),Y="mpg")
moderator=list(name=c("vs"),site=list(c("b1","b2")))
eq=multipleMediation(labels=labels,moderator=moderator,data=mtcars,range=FALSE,serial=FALSE,mode=1,bmatrix=c(1,1,1,1,1,1))
drawModel(equation=eq,labels=labels)
eq=multipleMediation(labels=labels,moderator=moderator,data=mtcars,range=FALSE,serial=FALSE,mode=1,bmatrix=c(1,1,1,1,1,1))
drawModel(equation=eq,labels=labels)
eq
cat(eq)
labels=list(X="wt",M=c("cyl","am"),Y="mpg")
moderator=list(name=c("vs"),site=list(c("b1","b2")))
eq=multipleMediation(labels=labels,moderator=moderator,data=mtcars,range=FALSE,serial=FALSE,mode=1,bmatrix=c(1,1,1,1,1,1))
drawModel(equation=eq,labels=labels)
eq=multipleMediation(labels=labels,moderator=moderator,data=mtcars,range=FALSE,serial=FALSE,mode=1)
drawModel(equation=eq,labels=labels)
labels=list(X="wt",M=c("cyl","am"),Y="mpg")
moderator=list(name=c("vs"),site=list(c("a1","a2")))
labels=list(X="X",M=c("M1","M2","M3"),Y="Y")
data=mtcars;X=NULL;M=NULL;Y=NULL; moderator=list()
covar=NULL;mode=0;range=TRUE;rangemode=1;serial=FALSE
contrast=1;bmatrix=c(1,1,0,1,0,0,0,1,1,1)
labels=list(X="X",M=c("M1","M2"),Y="Y")
bmatrix=c(1,1,1,1,1,1)
labels=list(X="wt",M=c("cyl","am"),Y="mpg")
moderator=list(name=c("vs"),site=list(c("b1","b2")))
if(is.null(X)) X=labels$X
if(is.null(M)) if(!is.null(labels$M)) M=labels$M
if(is.null(Y)) Y=labels$Y
res=c()
xcount=length(X)
if(!is.null(M)) {
mcount=length(M)
} else{
mcount=0
}
ycount=length(Y)
vars=c(X,M,Y,moderator$name,covar$name)
#         groupvars=c(groupvars,vars[i])
#     } else if((count>2)&(count<=maxylev)){
#         groupvars=c(groupvars,vars[i])
#     }
# }
# for(i in seq_along(groupvars)){
#     grouplabels[[groupvars[i]]]=LETTERS[3+i]
#     attr(grouplabels[[groupvars[i]]],"length")=length(unique(data[[groupvars[i]]]))-1
# }
# str(grouplabels)
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
# moderator=list(name=c("vs"),site=list(c("b1","b2")))
# name="vs"
# prefix="b"
# moderator
# name=MY
# name
# prefix="b"
mod2pos=function(moderator,name,prefix){
pos=list()
pos1=c()
# i=1
for(i in seq_along(name)) {
pos1=grep(name[i],moderator$name)
pos1
if(length(pos1)==1){
temp=moderator$site[[pos1]]
temp1=temp[str_detect(temp,prefix)]
temp1
res=str_extract(temp1,"[0-9]")
res
if(length(res)==1){
if(is.na(res)){
pos[[i]]=NULL
} else {
pos[[i]]=as.numeric(res)
}
} else{
pos[[i]]=as.numeric(res)
}
}
}
pos
}
pos=mod2pos(moderator,name=XM,prefix="a")
pos
eq1=makeCatEquation2(X=X,Y=M,W=XM,prefix="a",mode=mode,pos=pos,serial=serial)
# maxylev
eq1
eq1=makeCatEquation2(X=X,Y=M,W=XM,prefix="a",mode=mode,pos=pos,serial=serial)
# maxylev
eq1
eq1=makeCatEquation3(X=X,Y=M,W=XM,prefix="a",mode=mode,pos=pos,bmatrix=bmatrix,depy=FALSE)
# maxylev
eq1
if(!is.null(covar)){
if(mode){
eq1=addCovarEquation(eq1,covar,prefix=NULL)
} else{
eq1=addCovarEquation(eq1,covar,prefix="f")
}
}
eq1
temp1=unlist(strsplit(eq1,"\n"))
temp1=lapply(1:length(temp1),function(i){
unlist(strsplit(unlist(strsplit(temp1[i],"~",fixed=TRUE))[2],"+",fixed=TRUE))
})
temp1
# moderator
# MY
pos=mod2pos(moderator,name=MY,prefix="b")
pos
eq2=makeCatEquation2(X=M,Y=Y,W=MY,prefix="b",mode=mode,pos=pos)
eq2
eq2=makeCatEquation3(X=M,Y=Y,W=MY,prefix="b",mode=mode,pos=pos,bmatrix=bmatrix,depy=TRUE)
eq2
eq2=makeCatEquation2(X=M,Y=Y,W=MY,prefix="b",mode=mode,pos=pos)
pos
eq2
M
Y
MY
# X="X";Y=c("M1","M2","M3");W=NULL;labels=list();prefix="a";mode=0;pos=list();
# bmatrix=c(1,1,0,1,1,0,1,1,1,1);depy=FALSE
# bmatrix=c(1,1,1,1,1,1,1,1,1,1);depy=FALSE
# X=c("M1","M2","M3");Y="Y";W=NULL;labels=list();prefix="a";mode=0;pos=list();
# bmatrix=c(1,1,1,1,1,1,0,1,1,1);depy=TRUE
# X="X";Y="Y";W=NULL;prefix="a";bmatrix=c(1,1,1,1,1,1,0,1,1,1);depy=TRUE;depx=TRUE;mode=0;pos=list()
X=c("M1","M2");W=NULL;Y="Y";prefix="a";bmatrix=c(1,1,1,0,0,1);depy=TRUE;depx=FALSE;labels=list();mode=0
# X="X";Y=c("M1","M2","M3");W=NULL;labels=list();prefix="a";mode=0;pos=list();
# bmatrix=c(1,1,0,1,1,0,1,1,1,1);depy=FALSE
# bmatrix=c(1,1,1,1,1,1,1,1,1,1);depy=FALSE
# X=c("M1","M2","M3");Y="Y";W=NULL;labels=list();prefix="a";mode=0;pos=list();
# bmatrix=c(1,1,1,1,1,1,0,1,1,1);depy=TRUE
# X="X";Y="Y";W=NULL;prefix="a";bmatrix=c(1,1,1,1,1,1,0,1,1,1);depy=TRUE;depx=TRUE;mode=0;pos=list()
# X=c("M1","M2");W=NULL;Y="Y";prefix="a";bmatrix=c(1,1,1,0,0,1);depy=TRUE;depx=FALSE;labels=list();mode=0
X=c("cyl","am");Y="mpg";W="vs";pos=list(c(1,2))
if(is.null(X)) X=labels$X
if(is.null(W)) if(!is.null(labels$W)) W=labels$W
if(is.null(Y)) Y=labels$Y
xgroup<-wgroup<-c()
xcount<-wcount<-ycount<-0
xcount=length(X)
wcount=length(W)
ycount=length(Y)
temp=c()
j=1
j=1
for(j in 1:ycount){
res1=c()
if(depy==FALSE){
for(i in 1:xcount){
res=c()
res=c(res,X[i])
for(l in seq_along(W)){
if(length(pos)==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(length(pos[[l]])==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(i %in% pos[[l]]){
res=c(res,W[l],paste0(X[i],":",W[l]))
}
}
if(mode==0){
temp1=c()
for(k in 1:length(res)){
temp1=c(temp1,paste0(prefix,ifelse(xcount>1,i,""),
ifelse(ycount>1,j,""),"*",res[k]))
}
} else{
temp1=res
}
res1=c(res1,temp1)
if(j>1){
for(k in 2:j){
pos=1+sum(1:(j-1))+(k-1)
#cat("j=",j,",k=",k,"\n")
#cat("pos=",pos,",bmatrix[pos]=",bmatrix[pos],"\n")
if(bmatrix[pos]==1){
if(mode==0) {
res1=c(res1,paste0("d",j,k-1,"*",Y[k-1]))
} else{
res1=c(res1,Y[k-1])
}
}
}
}
}
} else if(depx==TRUE){
count=length(bmatrix)
count
xcount=matrix2no(bmatrix)
pos=1+sum(1:(xcount-1))
pos
bmatrix[pos]
if(bmatrix[pos]==1){
if(mode==0) {
res1=c(res1,paste0("c*",X))
} else{
res1=c(res1,X)
}
}
} else{
pos=1+sum(1:(xcount))
pos=pos+1
pos
l=1
for(k in pos:length(bmatrix)){
if(bmatrix[k]==1){
if(mode==0) {
res1=c(res1,paste0("b",l,"*",X[l]))
} else{
res1=c(res1,X[l])
}
}
l=l+1
}
}
res1
if(length(res1)>0) temp=c(temp,paste0(Y[j],"~",paste0(res1,collapse="+")))
}
temp
eq=paste0(temp,collapse="\n")
eq
if(is.null(X)) X=labels$X
if(is.null(W)) if(!is.null(labels$W)) W=labels$W
if(is.null(Y)) Y=labels$Y
xgroup<-wgroup<-c()
xcount<-wcount<-ycount<-0
xcount=length(X)
wcount=length(W)
ycount=length(Y)
(xcount=length(X))
j=1
for(j in 1:ycount){
res1=c()
if(depy==FALSE){
for(i in 1:xcount){
res=c()
res=c(res,X[i])
for(l in seq_along(W)){
if(length(pos)==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(length(pos[[l]])==0){
res=c(res,W[l],paste0(X[i],":",W[l]))
} else if(i %in% pos[[l]]){
res=c(res,W[l],paste0(X[i],":",W[l]))
}
}
if(mode==0){
temp1=c()
for(k in 1:length(res)){
temp1=c(temp1,paste0(prefix,ifelse(xcount>1,i,""),
ifelse(ycount>1,j,""),"*",res[k]))
}
} else{
temp1=res
}
res1=c(res1,temp1)
if(j>1){
for(k in 2:j){
pos=1+sum(1:(j-1))+(k-1)
#cat("j=",j,",k=",k,"\n")
#cat("pos=",pos,",bmatrix[pos]=",bmatrix[pos],"\n")
if(bmatrix[pos]==1){
if(mode==0) {
res1=c(res1,paste0("d",j,k-1,"*",Y[k-1]))
} else{
res1=c(res1,Y[k-1])
}
}
}
}
}
} else if(depx==TRUE){
count=length(bmatrix)
count
xcount=matrix2no(bmatrix)
pos=1+sum(1:(xcount-1))
pos
bmatrix[pos]
if(bmatrix[pos]==1){
if(mode==0) {
res1=c(res1,paste0("c*",X))
} else{
res1=c(res1,X)
}
}
} else{
pos=1+sum(1:(xcount))
pos=pos+1
pos
l=1
for(k in pos:length(bmatrix)){
if(bmatrix[k]==1){
if(mode==0) {
res1=c(res1,paste0("b",l,"*",X[l]))
} else{
res1=c(res1,X[l])
}
}
l=l+1
}
}
res1
if(length(res1)>0) temp=c(temp,paste0(Y[j],"~",paste0(res1,collapse="+")))
}
temp
temp=c()
j=1
library(processR)
devtools::document()
devtools::check()
