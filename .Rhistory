if(length(equations)==1){
temp=unlist(strsplit(equations,"\\+"))
} else{
temp=reduce(equations,productEq)
}
temp
maxOrder=max(str_count(temp,var))
eq=list()
for(i in 1:(maxOrder+1)){
eq[[i]]<-paste0(temp[str_count(temp,var)==(i-1)],collapse="+") %>%
str_replace_all(paste0("\\*",var),"")
}
eq
eq1=lapply(eq,function(x){
ifelse(str_detect(x,"\\+"),paste0("(",x,")"),x)
})
eq2<- lapply(1:length(eq1),function(i){
if(i==1) {
eq1[[i]]
} else if(i==2){
paste0(eq1[[i]],"*",var)
} else{
paste0(eq1[[i]],"*",var,"^",(i-1))
}
})
res<-eq2 %>% unlist() %>% paste(collapse="+")
if(mode==-1) {
result=c(result,res)
} else {
result=c(result,eq[[mode+1]])
}
}
result
}
string=c("(a1+b1*W)*(a2+b2*W)*(a3+b3*W)","a1+b1*W")
unfold(string)
unfold(string,mode=0)
unfold(string,mode=1)
unfold(string,mode=2)
#' Unfold equations
#' @param string Character vectors with equation
#' @param var name of variable
#' @param mode integer. Default value is -1. If 0, get intercept, If 1, get slope
#' @importFrom stringr str_count
#' @export
#' @examples
#' string=c("(a1+b1*W)*(a2+b2*W)*(a3+b3*W)","a1+b1*W")
#' unfold(string,mode=2)
unfold=function(string,var="W",mode=-1){
for(i in seq_along(string)){
equations<- string[i] %>% strsplit("\\)\\*\\(") %>%
unlist() %>%
str_replace_all("\\(","") %>%
str_replace_all("\\)","")
equations
if(length(equations)==1){
temp=unlist(strsplit(equations,"\\+"))
} else{
temp=reduce(equations,productEq)
}
temp
maxOrder=max(str_count(temp,var))
eq=list()
for(i in 1:(maxOrder+1)){
eq[[i]]<-paste0(temp[str_count(temp,var)==(i-1)],collapse="+") %>%
str_replace_all(paste0("\\*",var),"")
}
eq
eq1=lapply(eq,function(x){
ifelse(str_detect(x,"\\+"),paste0("(",x,")"),x)
})
eq2<- lapply(1:length(eq1),function(i){
if(i==1) {
eq1[[i]]
} else if(i==2){
paste0(eq1[[i]],"*",var)
} else{
paste0(eq1[[i]],"*",var,"^",(i-1))
}
})
res<-eq2 %>% unlist() %>% paste(collapse="+")
if(mode==-1) {
result=c(result,res)
} else {
if(length(eq)>=(mode+1)){
result=c(result,eq[[mode+1]])
} else{
result=c(result,0)
}
}
}
result
}
string=c("(a1+b1*W)*(a2+b2*W)*(a3+b3*W)","a1+b1*W")
unfold(string,mode=2)
string=c("(a1+b1*W)*(a2+b2*W)*(a3+b3*W)","a1+b1*W")
unfold(string,mode=3)
string=c("(a1+b1*W)*(a2+b2*W)*(a3+b3*W)","a1+b1*W")
unfold(string,mode=4)
string=c("(a1+b1*W)*(a2+b2*W)*(a3+b3*W)","a1+b1*W")
unfold(string,mode=0)
unfold(string,mode=1)
string=c("(a1+b1*W)*(a2+b2*W)*(a3+b3*W)","a1+b1*W")
unfold(string)
df=parameterEstimates(semfit)
df=df[str_detect(df$label,"direct"),c(3,4)]
df$rhs=str_replace_all(df$rhs,"sexism.mean","W")
df$eq=unfold(df$rhs)
df
df$eq
df$eq[1]
string=df$eq
string=df$eq[2]
df$quadratic=unfold(df$rhs,mode=2)
df
df$intercept=unfold(df$rhs,mode=0)
df$slope=unfold(df$rhs,mode=1)
df$quadratic=unfold(df$rhs,mode=2)
df
df=parameterEstimates(semfit)
df
df=df[str_detect(df$label,"direct"),c(3,4)]
df$rhs=str_replace_all(df$rhs,"sexism.mean","W")
df$eq=unfold(df$rhs)
df$intercept=unfold(df$rhs,mode=0)
df$slope=unfold(df$rhs,mode=1)
df$quadratic=unfold(df$rhs,mode=2)
df
df=parameterEstimates(semfit)
df
df=df[df$label!="",]
df
assign(df$label,df$est)
df
df=parameterEstimates(semfit)
df=df[df$label!="",]
df
for(i in 1:nrow(df)) assign(df$label[i],df$est[i])
df=df[str_detect(df$label,"direct"),c(3,4)]
df$rhs=str_replace_all(df$rhs,"sexism.mean","W")
df$eq=unfold(df$rhs)
df$intercept=unfold(df$rhs,mode=0)
df$slope=unfold(df$rhs,mode=1)
df$quadratic=unfold(df$rhs,mode=2)
df
df$intercept1=eval(parse(text=df$intercept))
df
eval(parse(text=df$intercept))
df
df$intercept
lapply(df$intercept,fucntion(x){eval(parse(text=x))})
lapply(df$intercept,function(x){eval(parse(text=x))})
unlist(lapply(df$intercept,function(x){eval(parse(text=x))}))
sapply(df$intercept,function(x){eval(parse(text=x))})
df$intercept=unfold(df$rhs,mode=1)
df$intercept1=sapply(df$intercept,function(x){eval(parse(text=x))})
df
myeval=function(equation){
sapply(equation,function(x){eval(parse(text=x))})
}
df$intercept=unfold(df$rhs,mode=1)
df$intercept1=myeval(df$intercept)
df
df$slope=unfold(df$rhs,mode=1)
df$slope1=myeval(df$slope)
df$quadratic=unfold(df$rhs,mode=2)
df$quadratic1=myeval(df$quadratic)
df
df$intercept=unfold(df$rhs,mode=1)
df$intercept=unfold(df$rhs,mode=0)
df$intercept1=myeval(df$intercept)
df$slope=unfold(df$rhs,mode=1)
df$slope1=myeval(df$slope)
df$quadratic=unfold(df$rhs,mode=2)
df$quadratic1=myeval(df$quadratic)
df
df=parameterEstimates(semfit)
df=df[df$label!="",]
df
for(i in 1:nrow(df)) assign(df$label[i],df$est[i])
df=df[str_detect(df$label,"direct"),c(3,4)]
df$rhs=str_replace_all(df$rhs,"sexism.mean","W")
df$eq=unfold(df$rhs)
df$intercept=unfold(df$rhs,mode=0)
df$intercept1=myeval(df$intercept)
df$slope=unfold(df$rhs,mode=1)
df$slope1=myeval(df$slope)
df$quadratic=unfold(df$rhs,mode=2)
df$quadratic1=myeval(df$quadratic)
df
df$eq1=ifelse(df$quadratic1==0,df$eq1,paste0(df$eq1,"+",df$quadratic,"W^2"))
df
df$eq1=paste0(df$intercept1,"+",paste0(df$slope1,"W"))
df
df$eq1=round(df$intercept1,digits)
df$eq1=ifelse(df$slope1==0,df$eq1,
paste0(df$eq1,ifelse(df$slope1>0,"+","-"),
abs(round(df$slope1,digits)),"W"))
df$eq1=ifelse(df$quadratic1==0,df$eq1,
paste0(df$eq1,ifelse(df$quadratic1>0,"+","-"),
abs(round(df$quadratic1,digits)),"W^2"))
df
digits=3
df$eq1=round(df$intercept1,digits)
df$eq1=ifelse(df$slope1==0,df$eq1,
paste0(df$eq1,ifelse(df$slope1>0,"+","-"),
abs(round(df$slope1,digits)),"W"))
df$eq1=ifelse(df$quadratic1==0,df$eq1,
paste0(df$eq1,ifelse(df$quadratic1>0,"+","-"),
abs(round(df$quadratic1,digits)),"W^2"))
df
df$eq1=ifelse(df$slope1==0,df$eq1,
paste0(df$eq1,ifelse(df$slope1>0,"+","-"),
abs(round(df$slope1,digits)),"*W"))
df$eq1=ifelse(df$quadratic1==0,df$eq1,
paste0(df$eq1,ifelse(df$quadratic1>0,"+","-"),
abs(round(df$quadratic1,digits)),"*W^2"))
df
df$eq1=round(df$intercept1,digits)
df$eq1=ifelse(df$slope1==0,df$eq1,
paste0(df$eq1,ifelse(df$slope1>0,"+","-"),
abs(round(df$slope1,digits)),"*W"))
df$eq1=ifelse(df$quadratic1==0,df$eq1,
paste0(df$eq1,ifelse(df$quadratic1>0,"+","-"),
abs(round(df$quadratic1,digits)),"*W^2"))
df
labels=list(X="protest",W="sexism",M="respappr",Y="liking")
moderator=list(name="sexism",site=list(c("a","c")))
data1=addCatVars(protest,"protest",mode=3)
eq=catMediation(X="protest",M="respappr",Y="liking",moderator=moderator,data=protest,maxylev=6,mode=1)
eq
fit=eq2fit(eq,data=data1)
modelsSummary(fit)
model=catMediation(X="protest",M="respappr",Y="liking",moderator=moderator,data=protest,maxylev=6,range=FALSE)
cat(model)
semfit=sem(model=model,data=data1)
digits=3
df=parameterEstimates(semfit)
df=df[df$label!="",]
df
for(i in 1:nrow(df)) assign(df$label[i],df$est[i])
df=df[str_detect(df$label,"direct"),c(3,4)]
df$rhs=str_replace_all(df$rhs,"sexism.mean","W")
df$eq=unfold(df$rhs)
df$intercept=unfold(df$rhs,mode=0)
df$intercept1=myeval(df$intercept)
df$slope=unfold(df$rhs,mode=1)
df$slope1=myeval(df$slope)
df$quadratic=unfold(df$rhs,mode=2)
df$quadratic1=myeval(df$quadratic)
df$eq1=round(df$intercept1,digits)
df$eq1=ifelse(df$slope1==0,df$eq1,
paste0(df$eq1,ifelse(df$slope1>0,"+","-"),
abs(round(df$slope1,digits)),"*W"))
df$eq1=ifelse(df$quadratic1==0,df$eq1,
paste0(df$eq1,ifelse(df$quadratic1>0,"+","-"),
abs(round(df$quadratic1,digits)),"*W^2"))
df
library(processR)
library(lavaan)
require(stringr)
require(tidyverse)
labels=list(X="protest",W="sexism",M="respappr",Y="liking")
moderator=list(name="sexism",site=list(c("a","c")))
data1=addCatVars(protest,"protest",mode=3)
eq=catMediation(X="protest",M="respappr",Y="liking",moderator=moderator,data=protest,maxylev=6,mode=1)
eq
fit=eq2fit(eq,data=data1)
modelsSummary(fit)
model=catMediation(X="protest",M="respappr",Y="liking",moderator=moderator,data=protest,maxylev=6,range=FALSE)
cat(model)
semfit=sem(model=model,data=data1)
digits=3
df=parameterEstimates(semfit)
df=df[df$label!="",]
df
for(i in 1:nrow(df)) assign(df$label[i],df$est[i])
df=df[str_detect(df$label,"direct"),c(3,4)]
df$rhs=str_replace_all(df$rhs,"sexism.mean","W")
df$eq=unfold(df$rhs)
df$intercept=unfold(df$rhs,mode=0)
df$intercept1=myeval(df$intercept)
df$slope=unfold(df$rhs,mode=1)
df$slope1=myeval(df$slope)
df$quadratic=unfold(df$rhs,mode=2)
df$quadratic1=myeval(df$quadratic)
df$eq1=round(df$intercept1,digits)
df$eq1=ifelse(df$slope1==0,df$eq1,
paste0(df$eq1,ifelse(df$slope1>0,"+","-"),
abs(round(df$slope1,digits)),"*W"))
df$eq1=ifelse(df$quadratic1==0,df$eq1,
paste0(df$eq1,ifelse(df$quadratic1>0,"+","-"),
abs(round(df$quadratic1,digits)),"*W^2"))
df
df2=df[c("slope1","intercept1","eq1")]
names(df2)=c("slope","intercept","label")
p=ggplot(data=data1,aes(x=sexism,y=liking))
p
add_lines(p,df)
require(predict3d)
add_lines(p,df)
p=ggplot(data=data1,aes(x=sexism,y=liking))
add_lines(p,df2)
df2=df[c("slope1","intercept1","eq1")]
names(df2)=c("slope","intercept","eq")
df2
df
df2=df[c("slope1","intercept1","eq1","label")]
names(df2)=c("slope","intercept","eq","label")
df2
df2$label=paste0(df2$label,"=="df2$eq)
p=ggplot(data=data1,aes(x=sexism,y=liking))
add_lines(p,df2)
df2$label=paste0(df2$label,"==",df2$eq)
p=ggplot(data=data1,aes(x=sexism,y=liking))
add_lines(p,df2)
add_lines(p,df2,parse=TRUE)
df2$label=paste0(df2$label,"==",df2$eq)
p=ggplot(data=data1,aes(x=sexism,y=liking))
add_lines(p,df2)
df2=df[c("slope1","intercept1","eq1","label")]
names(df2)=c("slope","intercept","eq","label")
df2$label=paste0(df2$label,"=",df2$eq)
p=ggplot(data=data1,aes(x=sexism,y=liking))
add_lines(p,df2)
add_lines(p,df2,xpos=c(0.7,0.3,0.7,0.3))
add_lines(p,df2,xpos=c(0.7,0.3,0.7,0.7))
add_lines(p,df2,xpos=c(0.7,0.3,0.3,0.7))
add_lines(p,df2,xpos=c(0.7,0.3,0.3,0.7),parse=TRUE)
df2$label=paste0(df2$label," == ",df2$eq)
df2=df[c("slope1","intercept1","eq1","label")]
names(df2)=c("slope","intercept","eq","label")
df2$label=paste0(df2$label," == ",df2$eq)
p=ggplot(data=data1,aes(x=sexism,y=liking))
add_lines(p,df2,xpos=c(0.7,0.3,0.3,0.7),parse=TRUE)
p=ggplot(data=data1,aes(x=sexism,y=liking))
add_lines(p,df2,xpos=c(0.7,0.3,0.3,0.7),parse=TRUE)
df
df2
quantile(data1$sexism,probs=c(0.16,0.5,0.84),type=6)
x=quantile(data1$sexism,probs=c(0.16,0.5,0.84),type=6)
x=quantile(data1$sexism,probs=c(0.16,0.5,0.84),type=6)
x
df2$x1=x[1]
df2$x2=x[2]
df2$x3=x[3]
df2$y1=df2$x1*slope+df2$intercept
df2$y1=df2$x1*df2$slope+df2$intercept
df2$y2=df2$x2*df2$slope+df2$intercept
df2$y3=df2$x3*df2$slope+df2$intercept
df2
x=quantile(data1$sexism,probs=c(0.16,0.5,0.84),type=6)
x=quantile(data1$sexism,probs=c(0.16,0.5,0.84),type=6)
y1=x[1]*df2$slope[1]+df2$intercept[1]
x=quantile(data1$sexism,probs=c(0.16,0.5,0.84),type=6)
x=quantile(data1$sexism,probs=c(0.16,0.5,0.84),type=6)
y=x[1]*df2$slope+df2$intercept
y
x
y1=x[1]*df2$slope+df2$intercept
y2=x[2]*df2$slope+df2$intercept
y3=x[3]*df2$slope+df2$intercept
df=data.frame(y1=y1,y2=y2,y3=y3)
df
df3=data.frame(y1=y1,y2=y2,y3=y3)
df3
df3$x1=x[1]
df2$x2=x[2]
df3$x2=x[2]
df3$x3=x[3]
df3
df3$label=df$label
df3
df
df=parameterEstimates(semfit)
df=df[df$label!="",]
df
for(i in 1:nrow(df)) assign(df$label[i],df$est[i])
df=df[str_detect(df$label,"direct"),c(3,4)]
df$rhs=str_replace_all(df$rhs,"sexism.mean","W")
df$eq=unfold(df$rhs)
df$intercept=unfold(df$rhs,mode=0)
df$intercept1=myeval(df$intercept)
df$slope=unfold(df$rhs,mode=1)
df$slope1=myeval(df$slope)
df$quadratic=unfold(df$rhs,mode=2)
df$quadratic1=myeval(df$quadratic)
df$eq1=round(df$intercept1,digits)
df$eq1=ifelse(df$slope1==0,df$eq1,
paste0(df$eq1,ifelse(df$slope1>0,"+","-"),
abs(round(df$slope1,digits)),"*W"))
df$eq1=ifelse(df$quadratic1==0,df$eq1,
paste0(df$eq1,ifelse(df$quadratic1>0,"+","-"),
abs(round(df$quadratic1,digits)),"*W^2"))
df
df3$label=df$label
df3
df3
df3 %>% gather(key="key",value="value",x1,x2,x3)
df3 %>% gather(key="key",value="x",x1,x2,x3)
df3 %>% gather(key="key",value="x",x1,x2,x3) %>%
gather(key="key2",value="y",y1,y2,y3)
df3<-df3 %>% gather(key="key",value="x",x1,x2,x3) %>%
gather(key="key2",value="y",y1,y2,y3)
df3
add_lines(p,df2,xpos=c(0.7,0.3,0.3,0.7),parse=TRUE)
p<-add_lines(p,df2,xpos=c(0.7,0.3,0.3,0.7),parse=TRUE)
p+geom_point(data=df3,aes(x=x,y=y,color=label))
x=quantile(data1$sexism,probs=c(0.16,0.5,0.84),type=6)
y1=x[1]*df2$slope+df2$intercept
y2=x[2]*df2$slope+df2$intercept
y3=x[3]*df2$slope+df2$intercept
df3=data.frame(y1=y1,y2=y2,y3=y3)
df3$x1=x[1]
df3$x2=x[2]
df3$x3=x[3]
df3$label=df$label
df3
df3<-df3 %>% gather(key="key",value="x",x1,x2,x3)
df3=data.frame(y1=y1,y2=y2,y3=y3)
df3$x1=x[1]
df3$x2=x[2]
df3$x3=x[3]
df3$label=df$label
df3
df3 %>% gather(key="key",value="x",x1,x2,x3)
df3 %>% gather(key="key",value="x",x1,x2,x3) %>%
gather(key="key2",value="y",y1,y2,y3)
df3=data.frame(y1=y1,y2=y2,y3=y3)
df3$x1=x[1]
df3$x2=x[2]
df3$x3=x[3]
df3$label=df$label
df3
p=ggplot(data=data1,aes(x=sexism,y=liking))
p<-add_lines(p,df2,xpos=c(0.7,0.3,0.3,0.7),parse=TRUE)
p+geom_point(data=df3,aes(x=x1,y=y1,color=label))
df3$no=1:4
df3
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no))
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no)))
p<-add_lines(p,df2,xpos=c(0.7,0.3,0.3,0.7),parse=TRUE)
p=ggplot(data=data1,aes(x=sexism,y=liking))
p<-add_lines(p,df2,xpos=c(0.7,0.3,0.3,0.7),parse=TRUE)
p
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no)))
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no)))+
geom_point(data=df3,aes(x=x2,y=y2,color=reorder(label,no)))+
geom_point(data=df3,aes(x=x3,y=y3,color=reorder(label,no)))
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no)))+
geom_point(data=df3,aes(x=x2,y=y2,color=reorder(label,no)))+
geom_point(data=df3,aes(x=x3,y=y3,color=reorder(label,no)))+
theme(legend.position="top")
df3
p=ggplot(data=data1,aes(x=sexism,y=liking))
p<-add_lines(p,df2,xpos=c(0.7,0.3,0.3,0.7),size=1,parse=TRUE)
p
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no)))+
geom_point(data=df3,aes(x=x2,y=y2,color=reorder(label,no)))+
geom_point(data=df3,aes(x=x3,y=y3,color=reorder(label,no)))+
theme(legend.position="top")
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no)))+
geom_text(data=df3,aes(x=x1,y=y1,color=reorder(label,no)),label=y1)
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no)))+
geom_text(data=df3,aes(x=x1,y=y1,color=reorder(label,no)),label=round(y1,3))
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no)))+
geom_text_repel(data=df3,aes(x=x1,y=y1,color=reorder(label,no)),label=round(y1,3))
require(ggrepel)
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no)))+
geom_text_repel(data=df3,aes(x=x1,y=y1,color=reorder(label,no)),label=round(y1,3))
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no)))+
geom_text_repel(data=df3,aes(x=x1,y=y1,color=reorder(label,no)),label=round(y1,3))+
geom_point(data=df3,aes(x=x2,y=y2,color=reorder(label,no)))+
geom_point(data=df3,aes(x=x3,y=y3,color=reorder(label,no)))+
theme(legend.position="top")
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no)))+
geom_text_repel(data=df3,aes(x=x1,y=y1,color=reorder(label,no),label=round(y1,3)),box.padding = 1)+
geom_point(data=df3,aes(x=x2,y=y2,color=reorder(label,no)))+
geom_point(data=df3,aes(x=x3,y=y3,color=reorder(label,no)))+
theme(legend.position="top")
p+geom_point(data=df3,aes(x=x1,y=y1,color=reorder(label,no)))+
geom_text_repel(data=df3,aes(x=x1,y=y1,color=reorder(label,no),label=round(y1,3)),box.padding = 1)+
geom_point(data=df3,aes(x=x2,y=y2,color=reorder(label,no)))+
geom_text_repel(data=df3,aes(x=x2,y=y2,color=reorder(label,no),label=round(y2,3)),box.padding = 1)+
geom_point(data=df3,aes(x=x3,y=y3,color=reorder(label,no)))+
geom_text_repel(data=df3,aes(x=x3,y=y3,color=reorder(label,no),label=round(y3,3)),box.padding = 1)+
theme(legend.position="top")
fit=eq2fit(eq,data=data1)
modelsSummary(fit)
condPlotCat(labels=labels,data=protest)
condPlotCat(labels=labels,data=protest,mode=3)
df=parameterEstimates(semfit)
df=df[df$label!="",]
df
for(i in 1:nrow(df)) assign(df$label[i],df$est[i])
df=df[str_detect(df$label,"direct"),c(3,4)]
df$rhs=str_replace_all(df$rhs,"sexism.mean","W")
df$eq=unfold(df$rhs)
df$intercept=unfold(df$rhs,mode=0)
df$intercept1=myeval(df$intercept)
df$slope=unfold(df$rhs,mode=1)
df$slope1=myeval(df$slope)
df$quadratic=unfold(df$rhs,mode=2)
df$quadratic1=myeval(df$quadratic)
df$eq1=round(df$intercept1,digits)
df$eq1=ifelse(df$slope1==0,df$eq1,
paste0(df$eq1,ifelse(df$slope1>0,"+","-"),
abs(round(df$slope1,digits)),"*W"))
df$eq1=ifelse(df$quadratic1==0,df$eq1,
paste0(df$eq1,ifelse(df$quadratic1>0,"+","-"),
abs(round(df$quadratic1,digits)),"*W^2"))
df
